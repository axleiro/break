{"code":"!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=4)}([function(e,t){e.exports=require(\"@solana/web3.js\")},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};function i(e){return new Promise((function(t){return setTimeout(t,e)}))}t.__esModule=!0,t.endlessRetry=t.notUndefined=t.sleep=void 0,t.sleep=i,t.notUndefined=function(e){return void 0!==e},t.endlessRetry=function(e,t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:0,r.label=1;case 1:return r.trys.push([1,3,,5]),console.log(e,\"fetching\"),[4,t()];case 2:return[2,r.sent()];case 3:return n=r.sent(),console.error(e,\"request failed, retrying\",n),[4,i(1e3)];case 4:return r.sent(),[3,5];case 5:return[3,0];case 6:return[2]}}))}))}},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.TX_PER_ACCOUNT=void 0;var c=n(0),u=n(1),s=n(20),a=i(n(21));t.TX_PER_ACCOUNT=parseInt(process.env.TX_PER_ACCOUNT||\"\")||1e3;var l=function(){function e(e,t,n){this.name=e,this.faucetAccount=t,this.createAccount=n,this.funded=[],this.reserved=[],this.replenishing=!1;var r=process.env.REDIS_URL;r&&(console.log(this.name,\"Connecting to\",r),this.client=a.default.createClient({url:r})),this.replenish()}return e.calculateRent=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,c,u,s;return o(this,(function(o){switch(o.label){case 0:return[4,e.getMinimumBalanceForRentExemption(t)];case 1:return n=o.sent(),[4,e.getEpochSchedule()];case 2:return r=o.sent().slotsPerEpoch,2.5,78894e3,c=(i=78894e3/r)/(365.25/7),2,u=Math.round(2*n/(2*i)),s=Math.max(c,2),[2,Math.ceil(u*s)]}}))}))},e.prototype.pushAccount=function(e){var t=e[0],n=e[1];return r(this,void 0,void 0,(function(){var e,r,i;return o(this,(function(o){switch(o.label){case 0:return this.client?(e=Buffer.from(t.secretKey).toString(\"base64\"),r=n.getTime(),i=JSON.stringify({key:e,expiry:r}),[4,s.promisify(this.client.rpush).bind(this.client,this.name,i)()]):[3,2];case 1:return o.sent(),[3,3];case 2:this.funded.push([t,n]),o.label=3;case 3:return[2]}}))}))},e.prototype.popAccount=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,u,a;return o(this,(function(o){switch(o.label){case 0:if(!this.client)return[3,4];o.label=1;case 1:return[4,s.promisify(this.client.lpop).bind(this.client,this.name)()];case 2:return null===(e=o.sent())?[2,void 0]:(t=JSON.parse(e),n=t.key,(r=t.expiry)<Date.now()?[3,1]:[2,[u=new c.Account(Buffer.from(n,\"base64\")),new Date(r)]]);case 3:return[3,5];case 4:if((i=this.funded.shift())&&(u=i[0],(a=i[1])>=new Date))return[2,[u,a]];o.label=5;case 5:return[2]}}))}))},e.prototype.size=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.client?[4,s.promisify(this.client.llen).bind(this.client,this.name)()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,this.funded.length]}}))}))},e.prototype.replenish=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,c,s,a;return o(this,(function(o){switch(o.label){case 0:return this.replenishing?[2]:(this.replenishing=!0,[4,this.size()]);case 1:e=o.sent(),o.label=2;case 2:return e<50?(t=Math.min(50-e,10),[4,this.createBatch(this.faucetAccount,t)]):[3,11];case 3:n=o.sent(),r=n.length<t,i=0,c=n,o.label=4;case 4:return i<c.length?(s=c[i],(a=new Date).setDate(a.getDate()+7),[4,this.pushAccount([s,a])]):[3,7];case 5:o.sent(),o.label=6;case 6:return i++,[3,4];case 7:return[4,this.size()];case 8:return e=o.sent(),console.log(this.name+\": \"+e),r?[4,u.sleep(1e3)]:[3,10];case 9:o.sent(),o.label=10;case 10:return[3,2];case 11:return this.replenishing=!1,[2]}}))}))},e.prototype.createBatch=function(e,t){return r(this,void 0,void 0,(function(){var n,i,c,u,s,a=this;return o(this,(function(l){switch(l.label){case 0:return n=[],[4,Promise.all(Array(t).fill(0).map((function(){return r(a,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.createAccount(e)];case 1:return[2,n.sent()];case 2:return t=n.sent(),console.error(\"Failed to replenish account supply\",t),[2,void 0];case 3:return[2]}}))}))})))];case 1:for(i=l.sent(),c=0,u=i;c<u.length;c++)void 0!==(s=u[c])&&n.push(s);return[2,n]}}))}))},e.prototype.reserve=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,c,u;return o(this,(function(o){switch(o.label){case 0:t=[],n=0,o.label=1;case 1:return n<e?[4,this.popAccount()]:[3,4];case 2:if(!(r=o.sent()))return[3,4];t.push(r),o.label=3;case 3:return n++,[3,1];case 4:if(!(t.length<e))return[3,9];i=0,c=t,o.label=5;case 5:return i<c.length?(u=c[i],[4,this.pushAccount(u)]):[3,8];case 6:o.sent(),o.label=7;case 7:return i++,[3,5];case 8:return[2,!1];case 9:return this.reserved=this.reserved.concat(t),[2,!0]}}))}))},e.prototype.unreserve=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(o){switch(o.label){case 0:if(this.reserved.length<e)throw new Error(\"unable to unreserve\");t=this.reserved.splice(0,e),n=0,r=t,o.label=1;case 1:return n<r.length?(i=r[n],[4,this.pushAccount(i)]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.pop=function(e){if(this.reserved.length<e)throw new Error(\"reserve depleted\");var t=this.reserved.splice(0,e);return this.replenish(),t.map((function(e){return e[0]}))},e}();t.default=l},function(e,t){e.exports=require(\"path\")},function(e,t,n){e.exports=n(5)},function(e,t,n){\"use strict\";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var o=r(n(6)),i=r(n(7)),c=r(n(8)),u=r(n(3)),s=r(n(9)),a=o.default();a.use((function(e,t,n){\"https\"!==e.header(\"x-forwarded-proto\")?t.redirect(\"https://\"+e.header(\"host\")+e.url):n()}));var l=u.default.join(__dirname,\"..\",\"..\"),f=u.default.join(l,\"client\",\"build\");console.log(\"Serving static files from: \"+f),a.use(\"/\",o.default.static(f)),a.get(\"/*\",(function(e,t){t.sendFile(u.default.join(f,\"/index.html\"))}));var h=i.default.createServer(a),p=process.env.PORT||8080;h.listen(p),console.log(\"Server listening on port: \"+p),process.env.DISABLE_API||(a.use(c.default()),a.use(o.default.json()),s.default.start(a,h))},function(e,t){e.exports=require(\"express\")},function(e,t){e.exports=require(\"http\")},function(e,t){e.exports=require(\"cors\")},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var c=n(0),u=n(10),s=i(n(11)),a=i(n(13)),l=i(n(14)),f=i(n(18)),h=n(1),p=i(n(23)),d=function(){function e(){}return e.getFeeCalculator=function(e){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:0,n.label=1;case 1:return n.trys.push([1,3,,5]),console.log(\"Connecting to cluster: \"+u.url),[4,e.getRecentBlockhash()];case 2:return t=n.sent().feeCalculator,console.log(\"Connected to cluster: \"+u.url),[2,t];case 3:return n.sent(),console.log(\"Failed to connect to cluster: \"+u.url),[4,h.sleep(1e3)];case 4:return n.sent(),[3,5];case 5:return[3,0];case 6:return[2]}}))}))},e.start=function(t,n){return r(this,void 0,void 0,(function(){var i,h,d,v,b,y,w=this;return o(this,(function(g){switch(g.label){case 0:return i=new c.Connection(u.url,\"recent\"),[4,l.default.create(i)];case 1:return h=g.sent(),p.default.start(n,h),[4,e.getFeeCalculator(i)];case 2:return d=g.sent(),[4,a.default.init(i,d)];case 3:return v=g.sent(),[4,s.default.load(i,v,d)];case 4:return b=g.sent(),[4,f.default.init(i,v,d,b)];case 5:return y=g.sent(),[4,h.connect()];case 6:return g.sent(),t.post(\"/accounts\",(function(e,t){return r(w,void 0,void 0,(function(){var n,r,i,c,u,s,a,l,f,h;return o(this,(function(o){switch(o.label){case 0:return n=parseInt(e.body.split),r=e.body.paymentKey,i=isNaN(n)?4:Math.max(1,Math.min(10,n)),v.free||r?[4,y.reserveAccounts(i)]:(t.status(400).send(\"Payment required\"),[2]);case 1:if(!o.sent())return[3,6];if(v.free)return[3,5];o.label=2;case 2:return o.trys.push([2,4,,5]),s=y.calculateCost(i,!1),[4,v.collectPayment(r,s)];case 3:return o.sent(),[3,5];case 4:return a=o.sent(),t.status(400).send(\"Payment failed: \"+a),y.unreserveAccounts(i),[2];case 5:return f=y.popAccounts(i),c=f.programAccounts,u=f.feeAccounts,[3,12];case 6:if(v.free)return[3,11];o.label=7;case 7:return o.trys.push([7,9,,10]),[4,y.createAccounts(r,i)];case 8:return h=o.sent(),c=h.programAccounts,u=h.feeAccounts,[3,10];case 9:return l=o.sent(),t.status(400).send(\"Payment failed: \"+l),y.unreserveAccounts(i),[2];case 10:return 0===c.length?(t.status(500).send(\"Failed to create new accounts, try again\"),[2]):[3,12];case 11:return t.status(500).send(\"Account supply depleted, try again\"),[2];case 12:return t.send(JSON.stringify({programAccounts:c.map((function(e){return e.publicKey.toBase58()})),feeAccounts:u.map((function(e){return Buffer.from(e.secretKey).toString(\"base64\")})),accountCapacity:y.accountCapacity()})).end(),[2]}}))}))})),t.post(\"/init\",(function(e,t){return r(w,void 0,void 0,(function(){var n,r;return o(this,(function(o){return n=parseInt(e.body.split),r=isNaN(n)?4:Math.max(1,Math.min(32,n)),t.send(JSON.stringify({programId:b.toString(),clusterUrl:u.urlTls,cluster:u.cluster,gameCost:y.calculateCost(r,!0),paymentRequired:!v.free})).end(),[2]}))}))})),[2]}}))}))},e}();t.default=d},function(e,t,n){\"use strict\";t.__esModule=!0,t.urlTls=t.url=t.cluster=void 0;var r=n(0);t.cluster=function(){if(process.env.LIVE){switch(process.env.CLUSTER){case\"devnet\":case\"testnet\":case\"mainnet-beta\":return process.env.CLUSTER}return\"devnet\"}}(),t.url=process.env.RPC_URL||(process.env.LIVE?r.clusterApiUrl(t.cluster,!1):\"http://localhost:8899\"),t.urlTls=process.env.RPC_URL||(process.env.LIVE?r.clusterApiUrl(t.cluster,!0):\"http://localhost:8899\")},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var c=n(0),u=i(n(3)),s=i(n(12)),a=n(1),l=s.default.promises,f=process.env.ENCODED_PROGRAM_KEY,h=function(){function e(){}return e.programAccount=function(){return f?new c.Account(Buffer.from(f,\"base64\")):new c.Account},e.load=function(t,n,i){return r(this,void 0,void 0,(function(){var r,s,f,h,p,d,v,b,y;return o(this,(function(o){switch(o.label){case 0:r=e.programAccount(),o.label=1;case 1:0,o.label=2;case 2:return o.trys.push([2,8,,10]),[4,t.getAccountInfo(r.publicKey)];case 3:return(null==(s=o.sent())?void 0:s.executable)?[2,r.publicKey]:(f=100,h=u.default.join(__dirname,\"..\",\"..\",\"program\",\"dist\",\"break_solana_program.so\"),console.log(\"Reading \"+h+\"...\"),[4,l.readFile(h)]);case 4:return p=o.sent(),console.log(\"Loading break solana program...\"),v=i.lamportsPerSignature*(c.BpfLoader.getMinNumSignatures(p.length)+f),[4,t.getMinimumBalanceForRentExemption(p.length)];case 5:return d=v+o.sent(),b=new c.Account,[4,c.sendAndConfirmTransaction(t,c.SystemProgram.transfer({fromPubkey:n.feeAccount.publicKey,toPubkey:b.publicKey,lamports:d}),[n.feeAccount],{confirmations:1,skipPreflight:!0})];case 6:return o.sent(),[4,c.BpfLoader.load(t,b,r,p)];case 7:return o.sent(),console.log(\"Program Loaded\"),[3,11];case 8:return y=o.sent(),console.error(\"Failed to load program\",y),[4,a.sleep(1e3)];case 9:return o.sent(),[3,10];case 10:return[3,1];case 11:return[2,r.publicKey]}}))}))},e}();t.default=h},function(e,t){e.exports=require(\"fs\")},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};t.__esModule=!0;var i=n(0),c=n(1),u=process.env.ENCODED_PAYER_KEY,s=100*i.LAMPORTS_PER_SOL,a=function(){function e(e,t,n,r){this.connection=e,this.feeCalculator=t,this.feeAccount=n,this.airdropEnabled=r,this.free=\"true\"===process.env.FREE_TO_PLAY,this.checkBalanceCounter=0}return e.prototype.address=function(){return this.feeAccount.publicKey},e.init=function(t,n){return r(this,void 0,void 0,(function(){var r,a,l,f;return o(this,(function(o){switch(o.label){case 0:return r=new i.Account,a=!0,u?(r=new i.Account(Buffer.from(u,\"base64\")),a=!1,console.log(\"Faucet address: \"+r.publicKey.toBase58()),[3,8]):[3,1];case 1:console.log(\"Airdrops enabled\"),o.label=2;case 2:0,o.label=3;case 3:return o.trys.push([3,5,,7]),[4,t.requestAirdrop(r.publicKey,s)];case 4:return o.sent(),[3,8];case 5:return l=o.sent(),console.error(\"Failed to airdrop to faucet\",l),[4,c.sleep(1e3)];case 6:return o.sent(),[3,7];case 7:return[3,2];case 8:return(f=new e(t,n,r,a)).checkBalance(),[2,f]}}))}))},e.prototype.collectPayment=function(e,t){return r(this,void 0,void 0,(function(){var n,r,c,u,s;return o(this,(function(o){switch(o.label){case 0:return n=new i.Account(Buffer.from(e,\"base64\")),r=n.publicKey,c=this.address(),u=i.SystemProgram.transfer({fromPubkey:r,toPubkey:c,lamports:t}),[4,this.connection.getBalance(n.publicKey,\"single\")];case 1:if(s=o.sent(),this.feeCalculator.lamportsPerSignature+t>s)throw new Error(\"Insufficient funds\");return[4,i.sendAndConfirmTransaction(this.connection,u,[n],{confirmations:0,skipPreflight:!0})];case 2:return o.sent(),[2]}}))}))},e.prototype.checkBalance=function(){return r(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:if(this.checkBalanceCounter++,this.checkBalanceCounter%50!=1)return[2];n.label=1;case 1:return n.trys.push([1,5,,6]),[4,this.connection.getBalance(this.feeAccount.publicKey)];case 2:return e=n.sent(),console.log(\"Faucet balance: \"+e),this.airdropEnabled&&e<=i.LAMPORTS_PER_SOL?[4,this.connection.requestAirdrop(this.feeAccount.publicKey,s)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[3,6];case 5:return t=n.sent(),console.error(\"failed to check faucet balance\",t),[3,6];case 6:return[2]}}))}))},e}();t.default=a},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var c=i(n(15)),u=n(1),s=i(n(16)),a=i(n(17)),l=!!process.env.TPU_DISABLED,f=function(){function e(e){var t=this;this.connection=e,this.connecting=!1,this.lastSlot=0,this.tpuAddresses=[],this.sockets=new Map,this.connected=function(){return t.activeProxies()>0||l},this.activeProxies=function(){return t.sockets.size},this.connect=function(){return r(t,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:if(l)return console.log(\"TPU Proxy disabled\"),[2];if(this.connecting)return[2];this.connecting=!0,n.label=1;case 1:return n.trys.push([1,3,,5]),console.log(\"TPU Proxy refreshing...\"),[4,this.reconnect()];case 2:return n.sent(),[3,5];case 3:return e=n.sent(),console.error(\"TPU Proxy failed to connect, reconnecting\",e),[4,u.sleep(1e3)];case 4:return n.sent(),[3,5];case 5:if(!this.connected())return[3,1];n.label=6;case 6:return t=this.activeProxies(),console.log(t,\"TPU port(s) connected\"),this.connecting=!1,[2]}}))}))},this.onTransaction=function(e){if(l)try{t.connection.sendRawTransaction(e)}catch(e){console.error(\"failed to send raw tx\")}else t.connected()?t.sockets.forEach((function(n,r){try{n.send(e,(function(e){return t.onTpuResult(r,e)}))}catch(e){t.onTpuResult(r,e)}})):t.connect()},this.reconnect=function(){return r(t,void 0,void 0,(function(){var e,t,n,r,i,u,s=this;return o(this,(function(a){switch(a.label){case 0:e=new Map,t=function(t){var n,r,i,u,a;return o(this,(function(o){switch(o.label){case 0:return n=t.split(\":\"),r=n[0],i=n[1],u=Number.parseInt(i),a=c.default.createSocket(\"udp4\"),[4,new Promise((function(e){a.on(\"error\",(function(e){return s.onTpuResult(t,e)})),a.connect(u,r,e)}))];case 1:return o.sent(),e.set(t,a),[2]}}))},n=0,r=this.tpuAddresses,a.label=1;case 1:return n<r.length?(i=r[n],[5,t(i)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:if(0===e.size)throw new Error(\"No sockets found\");return u=this.sockets,this.sockets=e,u.forEach((function(e){e.close()})),[2]}}))}))},this.onTpuResult=function(e,n){n&&(console.error(\"Error proxying transaction\",n),t.sockets.delete(e))}}return e.create=function(t){return r(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return n=new e(t),l?[3,3]:[4,a.default.start(t)];case 1:return r=o.sent(),[4,s.default.start(t)];case 2:i=o.sent(),t.onSlotChange((function(e){var t=e.slot;if(t>n.lastSlot+10){n.lastSlot=t;var o=r.getUpcomingNodes(t),c=[];o.forEach((function(e){var t=i.nodes.get(e);t&&c.push(t)})),n.tpuAddresses=c,n.connect()}})),o.label=3;case 3:return[2,n]}}))}))},e}();t.default=f},function(e,t){e.exports=require(\"dgram\")},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};t.__esModule=!0;var i=n(1),c=function(){function e(t,n){var i=this;this.connection=t,this.nodes=n,this.refreshing=!1,this.refresh=function(){return r(i,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.refreshing?[2]:(this.refreshing=!0,t=this,[4,e.getAvailableNodes(this.connection)]);case 1:return t.nodes=n.sent(),this.refreshing=!1,[2]}}))}))},setInterval((function(){return i.refresh()}),3e4)}return e.start=function(t){return r(void 0,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return[4,e.getAvailableNodes(t)];case 1:return n=r.sent(),[2,new e(t,n)]}}))}))},e.getAvailableNodes=function(e){return r(void 0,void 0,void 0,(function(){var t,n,r,c,u;return o(this,(function(o){switch(o.label){case 0:return t=new Map,[4,i.endlessRetry(\"getClusterNodes\",(function(){return e.getClusterNodes()}))];case 1:for(n=o.sent(),r=0,c=n;r<c.length;r++)(u=c[r]).tpu&&t.set(u.pubkey,u.tpu);return[2,t]}}))}))},e}();t.default=c},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};t.__esModule=!0;var i=n(1),c=function(){function e(e,t,n,c){var u=this;this.connection=e,this.schedule=t,this.currentEpochFirstSlot=n,this.slotsInEpoch=c,this.refreshing=!1,this.refresh=function(){return r(u,void 0,void 0,(function(){var e,t=this;return o(this,(function(n){switch(n.label){case 0:return this.refreshing?[2]:(this.refreshing=!0,e=this,[4,i.endlessRetry(\"getLeaderSchedule\",(function(){return t.connection.getLeaderSchedule()}))]);case 1:return e.schedule=n.sent(),this.refreshing=!1,[2]}}))}))}}return e.prototype.getUpcomingNodes=function(e){var t=Math.max(0,e-this.currentEpochFirstSlot),n=new Set;for(var r in this.schedule){var o=this.schedule[r].findIndex((function(e){return e>t}));o<0?this.schedule[r]=[]:(this.schedule[r]=this.schedule[r].slice(o),this.schedule[r][0]<t+40&&n.add(r))}return n},e.prototype.shouldRefresh=function(e){return e-this.currentEpochFirstSlot>=this.slotsInEpoch-20&&(this.currentEpochFirstSlot+=this.slotsInEpoch,!0)},e.start=function(t){return r(void 0,void 0,void 0,(function(){var n,r,c,u;return o(this,(function(o){switch(o.label){case 0:return[4,i.endlessRetry(\"getEpochInfo\",(function(){return t.getEpochInfo()}))];case 1:return n=o.sent(),[4,i.endlessRetry(\"getLeaderSchedule\",(function(){return t.getLeaderSchedule()}))];case 2:return r=o.sent(),c=n.absoluteSlot-n.slotIndex,u=new e(t,r,c,n.slotsInEpoch),t.onSlotChange((function(e){u.shouldRefresh(e.slot)&&u.refresh()})),[2,u]}}))}))},e}();t.default=c},function(e,t,n){\"use strict\";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var c=n(0),u=n(1),s=i(n(19)),a=i(n(22)),l=n(2),f=function(){function e(e,t,n,i){var u=this;this.connection=e,this.feeCalculator=t,this.feeAccounts=n,this.programAccounts=i,this.accountCapacity=function(){return l.TX_PER_ACCOUNT},this.createAccounts=function(e,t){return r(u,void 0,void 0,(function(){var n,r,i,u,s,a;return o(this,(function(o){switch(o.label){case 0:return n=new c.Account(Buffer.from(e,\"base64\")),[4,this.connection.getBalance(n.publicKey,\"single\")];case 1:if(r=o.sent(),i=this.calculateCost(t,!1),this.feeCalculator.lamportsPerSignature+i>r)throw new Error(\"Insufficient funds\");return[4,this.feeAccounts.supply.createBatch(n,t)];case 2:return u=o.sent(),[4,this.programAccounts.supply.createBatch(n,t)];case 3:return s=o.sent(),a=Math.min(u.length,s.length),[2,{feeAccounts:u.slice(0,a),programAccounts:s.slice(0,a)}]}}))}))},this.reserveAccounts=function(e){return r(u,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.feeAccounts.supply.reserve(e)];case 1:return(t=n.sent())?[4,this.programAccounts.supply.reserve(e)]:[3,3];case 2:t=n.sent(),n.label=3;case 3:return[2,t]}}))}))},this.unreserveAccounts=function(e){u.feeAccounts.supply.unreserve(e),u.programAccounts.supply.unreserve(e)},this.popAccounts=function(e){return{programAccounts:u.programAccounts.supply.pop(e),feeAccounts:u.feeAccounts.supply.pop(e)}}}return e.prototype.calculateCost=function(e,t){return(t?this.feeCalculator.lamportsPerSignature:0)+e*(this.programAccounts.accountCost+this.feeAccounts.accountCost)},e.init=function(t,n,i,c){return r(void 0,void 0,void 0,(function(){var r,l,f;return o(this,(function(o){switch(o.label){case 0:0,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,s.default.create(t,n,i)];case 2:return r=o.sent(),console.log(\"Fee Account Supply Created\"),[4,a.default.create(t,n,i,c)];case 3:return l=o.sent(),console.log(\"State Account Supply Created\"),[2,new e(t,i,r,l)];case 4:return f=o.sent(),console.error(\"Failed to initialize server\",f),[4,u.sleep(1e3)];case 5:return o.sent(),console.log(\"Retrying initialization\"),[3,6];case 6:return[3,0];case 7:return[2]}}))}))},e}();t.default=f},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,\"default\",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)\"default\"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};t.__esModule=!0;var s=n(0),a=i(n(2)),l=function(){function e(e,t){this.supply=e,this.accountCost=t}return e.create=function(t,n,r){return c(this,void 0,void 0,(function(){var o,i,l,f=this;return u(this,(function(h){switch(h.label){case 0:return[4,a.default.calculateRent(t,0)];case 1:return o=h.sent(),i=r.lamportsPerSignature,l=a.TX_PER_ACCOUNT*(i+o)+o,[2,new e(new a.default(\"Fee Account Supply\",n.feeAccount,(function(e){return c(f,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:return n=new s.Account,[4,s.sendAndConfirmTransaction(t,s.SystemProgram.transfer({fromPubkey:e.publicKey,toPubkey:n.publicKey,lamports:l}),[e],{confirmations:1,skipPreflight:!0})];case 1:return r.sent(),[2,n]}}))}))})),l+i)]}}))}))},e}();t.default=l},function(e,t){e.exports=require(\"util\")},function(e,t){e.exports=require(\"redis\")},function(e,t,n){\"use strict\";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,\"default\",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)\"default\"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,u)}s((r=r.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,r,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;c;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=c.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};t.__esModule=!0;var s=n(0),a=i(n(2)),l=function(){function e(e,t){this.supply=e,this.accountCost=t}return e.create=function(t,n,r,o){return c(this,void 0,void 0,(function(){var i,l,f,h,p=this;return u(this,(function(d){switch(d.label){case 0:return i=Math.ceil(a.TX_PER_ACCOUNT/8),[4,a.default.calculateRent(t,i)];case 1:return l=d.sent(),f=new a.default(\"Program Data Account Supply\",n.feeAccount,(function(e){return c(p,void 0,void 0,(function(){var n;return u(this,(function(r){switch(r.label){case 0:return n=new s.Account,[4,s.sendAndConfirmTransaction(t,s.SystemProgram.createAccount({fromPubkey:e.publicKey,newAccountPubkey:n.publicKey,lamports:l,space:i,programId:o}),[e,n],{confirmations:1,skipPreflight:!0})];case 1:return r.sent(),[2,n]}}))}))})),h=r.lamportsPerSignature,[2,new e(f,l+2*h)]}}))}))},e}();t.default=l},function(e,t,n){\"use strict\";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var o=r(n(24)),i=function(){function e(){}return e.start=function(e,t){var n=0,r=new o.default.Server({server:e});r.on(\"connection\",(function(e){n++,e.on(\"close\",(function(){return n--})),e.on(\"message\",t.onTransaction)})),setInterval((function(){r.clients.forEach((function(e){e.readyState===o.default.OPEN&&e.send(JSON.stringify({activeUsers:n}))}))}),1e3)},e}();t.default=i},function(e,t){e.exports=require(\"ws\")}]);","extractedComments":[]}