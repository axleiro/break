{"ast":null,"code":"import * as React from \"react\";\nimport { useAccounts, useConnection } from \"../api\";\nimport { useDispatch, ActionType } from \"./index\";\nimport * as Bytes from \"utils/bytes\";\nconst debugMode = new URLSearchParams(window.location.search).has(\"debug\");\n\nconst commitmentParam = () => {\n  const commitment = new URLSearchParams(window.location.search).get(\"commitment\");\n\n  switch (commitment) {\n    case \"recent\":\n    case \"single\":\n    case \"singleGossip\":\n    case \"max\":\n    case \"root\":\n      {\n        return commitment;\n      }\n\n    default:\n      {\n        return \"singleGossip\";\n      }\n  }\n};\n\nexport function ConfirmedHelper({\n  children\n}) {\n  const dispatch = useDispatch();\n  const connection = useConnection();\n  const accounts = useAccounts();\n  React.useEffect(() => {\n    if (connection === undefined || accounts === undefined) return;\n    const commitment = commitmentParam();\n    const partitionCount = accounts.programAccounts.length;\n    const accountSubscriptions = accounts.programAccounts.map((account, partition) => {\n      return debugMode ? [\"recent\", \"single\", \"singleGossip\"].map(commitment => connection.onAccountChange(account, (accountInfo, {\n        slot\n      }) => {\n        const ids = new Set(Bytes.programDataToIds(accountInfo.data));\n        const activeIdPartition = {\n          ids,\n          partition,\n          partitionCount\n        };\n        dispatch({\n          type: ActionType.UpdateIds,\n          activeIdPartition,\n          commitment,\n          estimatedSlot: slot\n        });\n      }, commitment)) : [connection.onAccountChange(account, (accountInfo, {\n        slot\n      }) => {\n        const ids = new Set(Bytes.programDataToIds(accountInfo.data));\n        const activeIdPartition = {\n          ids,\n          partition,\n          partitionCount\n        };\n        dispatch({\n          type: ActionType.UpdateIds,\n          activeIdPartition,\n          commitment,\n          estimatedSlot: slot\n        });\n      }, commitment)];\n    });\n    return () => {\n      accountSubscriptions.forEach(listeners => {\n        listeners.forEach(listener => {\n          connection.removeAccountChangeListener(listener);\n        });\n      });\n    };\n  }, [dispatch, connection, accounts]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, children);\n}","map":{"version":3,"sources":["/Users/jstarry/Workspace/solana/break/client/src/providers/transactions/confirmed.tsx"],"names":["React","useAccounts","useConnection","useDispatch","ActionType","Bytes","debugMode","URLSearchParams","window","location","search","has","commitmentParam","commitment","get","ConfirmedHelper","children","dispatch","connection","accounts","useEffect","undefined","partitionCount","programAccounts","length","accountSubscriptions","map","account","partition","onAccountChange","accountInfo","slot","ids","Set","programDataToIds","data","activeIdPartition","type","UpdateIds","estimatedSlot","forEach","listeners","listener","removeAccountChangeListener"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AAGA,SAASC,WAAT,EAAsBC,aAAtB,QAA2C,QAA3C;AACA,SAASC,WAAT,EAAsBC,UAAtB,QAAwC,SAAxC;AACA,OAAO,KAAKC,KAAZ,MAAuB,aAAvB;AAEA,MAAMC,SAAS,GAAG,IAAIC,eAAJ,CAAoBC,MAAM,CAACC,QAAP,CAAgBC,MAApC,EAA4CC,GAA5C,CAAgD,OAAhD,CAAlB;;AACA,MAAMC,eAAe,GAAG,MAAkB;AACxC,QAAMC,UAAU,GAAG,IAAIN,eAAJ,CAAoBC,MAAM,CAACC,QAAP,CAAgBC,MAApC,EAA4CI,GAA5C,CACjB,YADiB,CAAnB;;AAGA,UAAQD,UAAR;AACE,SAAK,QAAL;AACA,SAAK,QAAL;AACA,SAAK,cAAL;AACA,SAAK,KAAL;AACA,SAAK,MAAL;AAAa;AACX,eAAOA,UAAP;AACD;;AACD;AAAS;AACP,eAAO,cAAP;AACD;AAVH;AAYD,CAhBD;;AAmBA,OAAO,SAASE,eAAT,CAAyB;AAAEC,EAAAA;AAAF,CAAzB,EAA8C;AACnD,QAAMC,QAAQ,GAAGd,WAAW,EAA5B;AACA,QAAMe,UAAU,GAAGhB,aAAa,EAAhC;AACA,QAAMiB,QAAQ,GAAGlB,WAAW,EAA5B;AAEAD,EAAAA,KAAK,CAACoB,SAAN,CAAgB,MAAM;AACpB,QAAIF,UAAU,KAAKG,SAAf,IAA4BF,QAAQ,KAAKE,SAA7C,EAAwD;AAExD,UAAMR,UAAU,GAAGD,eAAe,EAAlC;AACA,UAAMU,cAAc,GAAGH,QAAQ,CAACI,eAAT,CAAyBC,MAAhD;AAEA,UAAMC,oBAAoB,GAAGN,QAAQ,CAACI,eAAT,CAAyBG,GAAzB,CAC3B,CAACC,OAAD,EAAUC,SAAV,KAAwB;AACtB,aAAOtB,SAAS,GACX,CAAC,QAAD,EAAW,QAAX,EAAqB,cAArB,CAAD,CAAuDoB,GAAvD,CACGb,UAAD,IACEK,UAAU,CAACW,eAAX,CACEF,OADF,EAEE,CAACG,WAAD,EAAmC;AAAEC,QAAAA;AAAF,OAAnC,KAAgD;AAC9C,cAAMC,GAAG,GAAG,IAAIC,GAAJ,CACV5B,KAAK,CAAC6B,gBAAN,CAAuBJ,WAAW,CAACK,IAAnC,CADU,CAAZ;AAGA,cAAMC,iBAAiB,GAAG;AACxBJ,UAAAA,GADwB;AAExBJ,UAAAA,SAFwB;AAGxBN,UAAAA;AAHwB,SAA1B;AAKAL,QAAAA,QAAQ,CAAC;AACPoB,UAAAA,IAAI,EAAEjC,UAAU,CAACkC,SADV;AAEPF,UAAAA,iBAFO;AAGPvB,UAAAA,UAHO;AAIP0B,UAAAA,aAAa,EAAER;AAJR,SAAD,CAAR;AAMD,OAjBH,EAkBElB,UAlBF,CAFJ,CADY,GAwBZ,CACEK,UAAU,CAACW,eAAX,CACEF,OADF,EAEE,CAACG,WAAD,EAAmC;AAAEC,QAAAA;AAAF,OAAnC,KAAgD;AAC9C,cAAMC,GAAG,GAAG,IAAIC,GAAJ,CAAQ5B,KAAK,CAAC6B,gBAAN,CAAuBJ,WAAW,CAACK,IAAnC,CAAR,CAAZ;AACA,cAAMC,iBAAiB,GAAG;AAAEJ,UAAAA,GAAF;AAAOJ,UAAAA,SAAP;AAAkBN,UAAAA;AAAlB,SAA1B;AACAL,QAAAA,QAAQ,CAAC;AACPoB,UAAAA,IAAI,EAAEjC,UAAU,CAACkC,SADV;AAEPF,UAAAA,iBAFO;AAGPvB,UAAAA,UAHO;AAIP0B,UAAAA,aAAa,EAAER;AAJR,SAAD,CAAR;AAMD,OAXH,EAYElB,UAZF,CADF,CAxBJ;AAwCD,KA1C0B,CAA7B;AA6CA,WAAO,MAAM;AACXY,MAAAA,oBAAoB,CAACe,OAArB,CAA8BC,SAAD,IAAe;AAC1CA,QAAAA,SAAS,CAACD,OAAV,CAAmBE,QAAD,IAAc;AAC9BxB,UAAAA,UAAU,CAACyB,2BAAX,CAAuCD,QAAvC;AACD,SAFD;AAGD,OAJD;AAKD,KAND;AAOD,GA1DD,EA0DG,CAACzB,QAAD,EAAWC,UAAX,EAAuBC,QAAvB,CA1DH;AA4DA,sBAAO,0CAAGH,QAAH,CAAP;AACD","sourcesContent":["import * as React from \"react\";\n\nimport { AccountInfo, Commitment } from \"@solana/web3.js\";\nimport { useAccounts, useConnection } from \"../api\";\nimport { useDispatch, ActionType } from \"./index\";\nimport * as Bytes from \"utils/bytes\";\n\nconst debugMode = new URLSearchParams(window.location.search).has(\"debug\");\nconst commitmentParam = (): Commitment => {\n  const commitment = new URLSearchParams(window.location.search).get(\n    \"commitment\"\n  );\n  switch (commitment) {\n    case \"recent\":\n    case \"single\":\n    case \"singleGossip\":\n    case \"max\":\n    case \"root\": {\n      return commitment;\n    }\n    default: {\n      return \"singleGossip\";\n    }\n  }\n};\n\ntype Props = { children: React.ReactNode };\nexport function ConfirmedHelper({ children }: Props) {\n  const dispatch = useDispatch();\n  const connection = useConnection();\n  const accounts = useAccounts();\n\n  React.useEffect(() => {\n    if (connection === undefined || accounts === undefined) return;\n\n    const commitment = commitmentParam();\n    const partitionCount = accounts.programAccounts.length;\n\n    const accountSubscriptions = accounts.programAccounts.map(\n      (account, partition) => {\n        return debugMode\n          ? ([\"recent\", \"single\", \"singleGossip\"] as Commitment[]).map(\n              (commitment) =>\n                connection.onAccountChange(\n                  account,\n                  (accountInfo: AccountInfo<Buffer>, { slot }) => {\n                    const ids = new Set(\n                      Bytes.programDataToIds(accountInfo.data)\n                    );\n                    const activeIdPartition = {\n                      ids,\n                      partition,\n                      partitionCount,\n                    };\n                    dispatch({\n                      type: ActionType.UpdateIds,\n                      activeIdPartition,\n                      commitment,\n                      estimatedSlot: slot,\n                    });\n                  },\n                  commitment\n                )\n            )\n          : [\n              connection.onAccountChange(\n                account,\n                (accountInfo: AccountInfo<Buffer>, { slot }) => {\n                  const ids = new Set(Bytes.programDataToIds(accountInfo.data));\n                  const activeIdPartition = { ids, partition, partitionCount };\n                  dispatch({\n                    type: ActionType.UpdateIds,\n                    activeIdPartition,\n                    commitment,\n                    estimatedSlot: slot,\n                  });\n                },\n                commitment\n              ),\n            ];\n      }\n    );\n\n    return () => {\n      accountSubscriptions.forEach((listeners) => {\n        listeners.forEach((listener) => {\n          connection.removeAccountChangeListener(listener);\n        });\n      });\n    };\n  }, [dispatch, connection, accounts]);\n\n  return <>{children}</>;\n}\n"]},"metadata":{},"sourceType":"module"}