{"ast":null,"code":"var _jsxFileName = \"/Users/jstarry/Workspace/solana/break/client/src/providers/server.tsx\";\nimport React from \"react\";\nimport { clusterApiUrl } from \"@solana/web3.js\";\nimport { useLocation } from \"react-router-dom\";\nimport { isLocalHost } from \"../utils\";\nexport const DEFAULT_SERVER = isLocalHost() ? \"custom\" : \"mainnet-beta\";\nexport const SERVERS = isLocalHost() ? [\"custom\"] : [\"mainnet-beta\", \"testnet\", \"devnet\", \"custom\"];\nexport function serverName(server) {\n  switch (server) {\n    case \"mainnet-beta\":\n      return \"Mainnet Beta\";\n\n    case \"testnet\":\n      return \"Testnet\";\n\n    case \"devnet\":\n      return \"Devnet\";\n\n    case \"custom\":\n      return \"Custom\";\n  }\n}\nexport function serverInfo(server) {\n  return server === \"custom\" ? \"Use custom server\" : clusterApiUrl(server);\n}\n\nfunction parseQuery(query) {\n  const clusterParam = query.get(\"cluster\");\n\n  switch (clusterParam) {\n    case \"devnet\":\n      return \"devnet\";\n\n    case \"testnet\":\n      return \"testnet\";\n\n    case \"mainnet-beta\":\n      return \"mainnet-beta\";\n\n    default:\n      return DEFAULT_SERVER;\n  }\n}\n\nconst ModalContext = React.createContext(undefined);\nconst ServerContext = React.createContext(undefined);\nexport function ServerProvider({\n  children\n}) {\n  const query = new URLSearchParams(useLocation().search);\n  const serverParam = parseQuery(query);\n  const [server, setServer] = React.useState(serverParam);\n  const [customUrl, setCustomUrl] = React.useState(serverParam);\n  const [showModal, setShowModal] = React.useState(false); // Update state when query params change\n\n  React.useEffect(() => {\n    setServer(serverParam);\n  }, [serverParam]);\n  return /*#__PURE__*/React.createElement(ServerContext.Provider, {\n    value: {\n      server,\n      setServer,\n      customUrl,\n      setCustomUrl\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(ModalContext.Provider, {\n    value: [showModal, setShowModal],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 7\n    }\n  }, children));\n}\n\nfunction getServerUrl(server, customUrl) {\n  switch (server) {\n    case \"custom\":\n      {\n        if (customUrl.length > 0) return customUrl;\n        const hostname = window.location.hostname;\n        return `http://${hostname}:${process.env.PORT || 8080}`;\n      }\n\n    default:\n      {\n        const useHttp = isLocalHost();\n        let slug = server;\n\n        if (server === \"mainnet-beta\") {\n          slug = \"mainnet\";\n        }\n\n        return `${useHttp ? \"http\" : \"https\"}://break-solana-${slug}.herokuapp.com`;\n      }\n  }\n}\n\nexport function useServer() {\n  const context = React.useContext(ServerContext);\n\n  if (!context) {\n    throw new Error(`useServer must be used within a ServerProvider`);\n  }\n\n  const {\n    server,\n    customUrl\n  } = context;\n  const httpUrl = getServerUrl(server, customUrl);\n  console.log(httpUrl);\n  const webSocketUrl = httpUrl.replace(\"http\", \"ws\");\n  return {\n    server,\n    httpUrl,\n    webSocketUrl,\n    info: serverInfo(server),\n    name: serverName(server)\n  };\n}\nexport function useCustomUrl() {\n  const context = React.useContext(ServerContext);\n\n  if (!context) {\n    throw new Error(`useCustomUrl must be used within a ServerProvider`);\n  }\n\n  return [context.customUrl, context.setCustomUrl];\n}\nexport function useClusterModal() {\n  const context = React.useContext(ModalContext);\n\n  if (!context) {\n    throw new Error(`useClusterModal must be used within a ServerProvider`);\n  }\n\n  return context;\n}","map":{"version":3,"sources":["/Users/jstarry/Workspace/solana/break/client/src/providers/server.tsx"],"names":["React","clusterApiUrl","useLocation","isLocalHost","DEFAULT_SERVER","SERVERS","serverName","server","serverInfo","parseQuery","query","clusterParam","get","ModalContext","createContext","undefined","ServerContext","ServerProvider","children","URLSearchParams","search","serverParam","setServer","useState","customUrl","setCustomUrl","showModal","setShowModal","useEffect","getServerUrl","length","hostname","window","location","process","env","PORT","useHttp","slug","useServer","context","useContext","Error","httpUrl","console","log","webSocketUrl","replace","info","name","useCustomUrl","useClusterModal"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { clusterApiUrl, Cluster } from \"@solana/web3.js\";\nimport { useLocation } from \"react-router-dom\";\nimport { isLocalHost } from \"../utils\";\n\ntype Server = Cluster | \"custom\";\nexport const DEFAULT_SERVER = isLocalHost() ? \"custom\" : \"mainnet-beta\";\nexport const SERVERS: Server[] = isLocalHost() ? [\"custom\"] : [\"mainnet-beta\", \"testnet\", \"devnet\", \"custom\"];\n\nexport function serverName(server: Server): string {\n  switch (server) {\n    case \"mainnet-beta\":\n      return \"Mainnet Beta\";\n    case \"testnet\":\n      return \"Testnet\";\n    case \"devnet\":\n      return \"Devnet\";\n    case \"custom\":\n      return \"Custom\";\n  }\n}\n\nexport function serverInfo(server: Server): string {\n  return server === \"custom\" ? \"Use custom server\" : clusterApiUrl(server);\n}\n\nfunction parseQuery(query: URLSearchParams): Server {\n  const clusterParam = query.get(\"cluster\");\n  switch (clusterParam) {\n    case \"devnet\":\n      return \"devnet\";\n    case \"testnet\":\n      return \"testnet\";\n    case \"mainnet-beta\":\n      return \"mainnet-beta\";\n    default:\n      return DEFAULT_SERVER;\n  }\n}\n\ntype SetShowModal = React.Dispatch<React.SetStateAction<boolean>>;\nconst ModalContext = React.createContext<[boolean, SetShowModal] | undefined>(\n  undefined\n);\ntype SetCustomUrl = React.Dispatch<React.SetStateAction<string>>;\ntype SetServer = React.Dispatch<React.SetStateAction<Server>>;\ntype ServerState = {\n  server: Server;\n  setServer: SetServer;\n  customUrl: string;\n  setCustomUrl: SetCustomUrl;\n};\nconst ServerContext = React.createContext<ServerState | undefined>(\n  undefined\n);\n\ntype ProviderProps = { children: React.ReactNode };\nexport function ServerProvider({ children }: ProviderProps) {\n  const query = new URLSearchParams(useLocation().search);\n  const serverParam = parseQuery(query);\n  const [server, setServer] = React.useState<Server>(serverParam);\n  const [customUrl, setCustomUrl] = React.useState<string>(serverParam);\n  const [showModal, setShowModal] = React.useState(false);\n\n  // Update state when query params change\n  React.useEffect(() => {\n    setServer(serverParam);\n  }, [serverParam]);\n\n  return (\n    <ServerContext.Provider value={{server, setServer, customUrl, setCustomUrl}}>\n      <ModalContext.Provider value={[showModal, setShowModal]}>\n        {children}\n      </ModalContext.Provider>\n    </ServerContext.Provider>\n  );\n}\n\nfunction getServerUrl(server: Server, customUrl: string) {\n  switch (server) {\n    case \"custom\": {\n      if (customUrl.length > 0) return customUrl;\n      const hostname = window.location.hostname;\n      return `http://${hostname}:${process.env.PORT || 8080}`;\n    }\n    default: {\n      const useHttp = isLocalHost();\n      let slug: string = server;\n      if (server === \"mainnet-beta\") {\n        slug = \"mainnet\";\n      }\n      return `${\n        useHttp ? \"http\" : \"https\"\n      }://break-solana-${slug}.herokuapp.com`;\n    }\n  }\n}\n\nexport function useServer() {\n  const context = React.useContext(ServerContext);\n  if (!context) {\n    throw new Error(`useServer must be used within a ServerProvider`);\n  }\n  const {server, customUrl} = context;\n  const httpUrl = getServerUrl(server, customUrl);\n  console.log(httpUrl);\n  const webSocketUrl = httpUrl.replace(\"http\", \"ws\");\n\n  return {\n    server,\n    httpUrl,\n    webSocketUrl,\n    info: serverInfo(server),\n    name: serverName(server),\n  };\n}\n\nexport function useCustomUrl(): [string, SetCustomUrl] {\n  const context = React.useContext(ServerContext);\n  if (!context) {\n    throw new Error(`useCustomUrl must be used within a ServerProvider`);\n  }\n  return [context.customUrl, context.setCustomUrl];\n}\n\nexport function useClusterModal() {\n  const context = React.useContext(ModalContext);\n  if (!context) {\n    throw new Error(`useClusterModal must be used within a ServerProvider`);\n  }\n  return context;\n}\n"]},"metadata":{},"sourceType":"module"}