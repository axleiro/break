{"ast":null,"code":"import _slicedToArray from\"/Users/jstarry/Workspace/solana/break/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useEffect,useCallback}from\"react\";import{useThrottle}from\"@react-hook/throttle\";import{TransactionSquare}from\"./TxSquare\";import{useCreateTx,useTransactions}from\"providers/transactions\";import{useGameState,useResetGame,COUNTDOWN_SECS,useCountdown}from\"providers/game\";export function TransactionContainer(_ref){var enabled=_ref.enabled;var scrollEl=useRef(null);var rawTransactions=useTransactions();var _useThrottle=useThrottle(rawTransactions,10),_useThrottle2=_slicedToArray(_useThrottle,2),transactions=_useThrottle2[0],setTransactions=_useThrottle2[1];var createTx=useCreateTx();var _useGameState=useGameState(),_useGameState2=_slicedToArray(_useGameState,1),gameState=_useGameState2[0];var _useCountdown=useCountdown(),_useCountdown2=_slicedToArray(_useCountdown,2),countdown=_useCountdown2[0],setCountdown=_useCountdown2[1];var resetGame=useResetGame();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),rapidFire=_React$useState2[0],setRapidFire=_React$useState2[1];var makeTransaction=useCallback(function(){if(enabled){if(countdown!==undefined){createTx();}else if(gameState===\"play\"){createTx();setCountdown(performance.now());}}},[enabled,createTx,gameState,countdown,setCountdown]);useEffect(function(){if(!rapidFire||!enabled){setRapidFire(false);return;}var intervalId;var timeoutId=setTimeout(function(){intervalId=setInterval(function(){makeTransaction();},30);},300);return function(){clearTimeout(timeoutId);clearInterval(intervalId);};},[rapidFire,enabled,makeTransaction]);useEffect(function(){var testMode=new URLSearchParams(window.location.search).has(\"test\");if(!testMode)return;var testInterval=window.setInterval(function(){return makeTransaction();},30);return function(){return clearInterval(testInterval);};},[makeTransaction]);useEffect(function(){document.addEventListener(\"keyup\",makeTransaction);return function(){document.removeEventListener(\"keyup\",makeTransaction);};},[makeTransaction]);useEffect(function(){setTransactions(rawTransactions);},[rawTransactions,setTransactions]);useEffect(function(){var current=scrollEl.current;if(current){current.scrollTop=current.scrollHeight;}},[transactions.length]);return/*#__PURE__*/React.createElement(\"div\",{className:\"card h-100 mb-0\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-header\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(HelpButton,null),/*#__PURE__*/React.createElement(\"span\",{className:\"text-truncate\"},\"Live Transaction Statuses\")),/*#__PURE__*/React.createElement(\"div\",{className:\"text-primary d-none d-md-block\"},enabled?\"Press any key to send a transaction\":\"Game finished\")),/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"tx-wrapper border-1 border-primary h-100 position-relative\"},!transactions.length&&enabled?/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex h-100 justify-content-center align-items-center p-3\"},/*#__PURE__*/React.createElement(\"h2\",{className:\"text-center\"},\"Try to break Solana's network by sending as many transactions as you can in \",COUNTDOWN_SECS,\" seconds!\")):null,/*#__PURE__*/React.createElement(\"div\",{ref:scrollEl,className:\"square-container\",tabIndex:0},transactions.map(function(tx){return/*#__PURE__*/React.createElement(TransactionSquare,{key:tx.details.signature,transaction:tx});})))),/*#__PURE__*/React.createElement(\"div\",{className:\"card-footer\"},/*#__PURE__*/React.createElement(\"span\",{className:\"btn btn-pink w-100 text-uppercase text-truncate touch-action-none\",onContextMenu:function onContextMenu(e){return e.preventDefault();},onPointerDown:function onPointerDown(){return setRapidFire(true);},onPointerUp:function onPointerUp(){return setRapidFire(false);},onPointerLeave:function onPointerLeave(){return setRapidFire(false);},onPointerCancel:function onPointerCancel(){return setRapidFire(false);},onClick:enabled?makeTransaction:resetGame},/*#__PURE__*/React.createElement(\"span\",{className:\"fe fe-\".concat(enabled?\"zap\":\"repeat\",\" mr-2\")}),enabled?\"Send new transactions\":\"Play again\")));}function Legend(_ref2){var show=_ref2.show;if(!show)return null;return/*#__PURE__*/React.createElement(\"div\",{className:\"popover bs-popover-bottom right show\"},/*#__PURE__*/React.createElement(\"div\",{className:\"arrow\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"popover-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex flex-column\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center mb-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"btn square legend slideInRight btn-dark mr-2\"}),/*#__PURE__*/React.createElement(\"span\",null,\"Pending transaction\")),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center mb-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"btn square legend slideInRight btn-primary mr-2\"}),/*#__PURE__*/React.createElement(\"span\",null,\"Confirmed transaction\")),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"btn square legend slideInRight btn-danger mr-2\"}),/*#__PURE__*/React.createElement(\"span\",null,\"Failed transaction\")))));}function HelpButton(){var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),show=_React$useState4[0],setShow=_React$useState4[1];return/*#__PURE__*/React.createElement(\"div\",{className:\"popover-container c-pointer mr-3\",onClick:function onClick(){return setShow(true);},onMouseOver:function onMouseOver(){return setShow(true);},onMouseOut:function onMouseOut(){return setShow(false);}},/*#__PURE__*/React.createElement(\"span\",{className:\"fe fe-help-circle\"}),/*#__PURE__*/React.createElement(Legend,{show:show}));}","map":{"version":3,"sources":["/Users/jstarry/Workspace/solana/break/client/src/components/TxContainer.tsx"],"names":["React","useRef","useEffect","useCallback","useThrottle","TransactionSquare","useCreateTx","useTransactions","useGameState","useResetGame","COUNTDOWN_SECS","useCountdown","TransactionContainer","enabled","scrollEl","rawTransactions","transactions","setTransactions","createTx","gameState","countdown","setCountdown","resetGame","useState","rapidFire","setRapidFire","makeTransaction","undefined","performance","now","intervalId","timeoutId","setTimeout","setInterval","clearTimeout","clearInterval","testMode","URLSearchParams","window","location","search","has","testInterval","document","addEventListener","removeEventListener","current","scrollTop","scrollHeight","length","map","tx","details","signature","e","preventDefault","Legend","show","HelpButton","setShow"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useCallback } from \"react\";\nimport { useThrottle } from \"@react-hook/throttle\";\n\nimport { TransactionSquare } from \"./TxSquare\";\nimport { useCreateTx, useTransactions } from \"providers/transactions\";\nimport {\n  useGameState,\n  useResetGame,\n  COUNTDOWN_SECS,\n  useCountdown,\n} from \"providers/game\";\n\nexport function TransactionContainer({ enabled }: { enabled?: boolean }) {\n  const scrollEl = useRef<HTMLDivElement>(null);\n  const rawTransactions = useTransactions();\n  const [transactions, setTransactions] = useThrottle(rawTransactions, 10);\n  const createTx = useCreateTx();\n  const [gameState] = useGameState();\n  const [countdown, setCountdown] = useCountdown();\n  const resetGame = useResetGame();\n  const [rapidFire, setRapidFire] = React.useState(false);\n\n  const makeTransaction = useCallback(() => {\n    if (enabled) {\n      if (countdown !== undefined) {\n        createTx();\n      } else if (gameState === \"play\") {\n        createTx();\n        setCountdown(performance.now());\n      }\n    }\n  }, [enabled, createTx, gameState, countdown, setCountdown]);\n\n  useEffect(() => {\n    if (!rapidFire || !enabled) {\n      setRapidFire(false);\n      return;\n    }\n\n    let intervalId: NodeJS.Timeout;\n    const timeoutId = setTimeout(() => {\n      intervalId = setInterval(() => {\n        makeTransaction();\n      }, 30);\n    }, 300);\n\n    return () => {\n      clearTimeout(timeoutId);\n      clearInterval(intervalId);\n    };\n  }, [rapidFire, enabled, makeTransaction]);\n\n  useEffect(() => {\n    const testMode = new URLSearchParams(window.location.search).has(\"test\");\n    if (!testMode) return;\n    const testInterval = window.setInterval(() => makeTransaction(), 30);\n    return () => clearInterval(testInterval);\n  }, [makeTransaction]);\n\n  useEffect(() => {\n    document.addEventListener(\"keyup\", makeTransaction);\n    return () => {\n      document.removeEventListener(\"keyup\", makeTransaction);\n    };\n  }, [makeTransaction]);\n\n  useEffect(() => {\n    setTransactions(rawTransactions);\n  }, [rawTransactions, setTransactions]);\n\n  useEffect(() => {\n    const current = scrollEl.current;\n    if (current) {\n      current.scrollTop = current.scrollHeight;\n    }\n  }, [transactions.length]);\n\n  return (\n    <div className=\"card h-100 mb-0\">\n      <div className=\"card-header\">\n        <div className=\"d-flex align-items-center\">\n          <HelpButton />\n          <span className=\"text-truncate\">Live Transaction Statuses</span>\n        </div>\n        <div className=\"text-primary d-none d-md-block\">\n          {enabled ? \"Press any key to send a transaction\" : \"Game finished\"}\n        </div>\n      </div>\n      <div className=\"card-body\">\n        <div className=\"tx-wrapper border-1 border-primary h-100 position-relative\">\n          {!transactions.length && enabled ? (\n            <div className=\"d-flex h-100 justify-content-center align-items-center p-3\">\n              <h2 className=\"text-center\">\n                Try to break Solana's network by sending as many transactions as\n                you can in {COUNTDOWN_SECS} seconds!\n              </h2>\n            </div>\n          ) : null}\n          <div ref={scrollEl} className=\"square-container\" tabIndex={0}>\n            {transactions.map((tx) => (\n              <TransactionSquare key={tx.details.signature} transaction={tx} />\n            ))}\n          </div>\n        </div>\n      </div>\n      <div className=\"card-footer\">\n        <span\n          className=\"btn btn-pink w-100 text-uppercase text-truncate touch-action-none\"\n          onContextMenu={(e) => e.preventDefault()}\n          onPointerDown={() => setRapidFire(true)}\n          onPointerUp={() => setRapidFire(false)}\n          onPointerLeave={() => setRapidFire(false)}\n          onPointerCancel={() => setRapidFire(false)}\n          onClick={enabled ? makeTransaction : resetGame}\n        >\n          <span className={`fe fe-${enabled ? \"zap\" : \"repeat\"} mr-2`}></span>\n          {enabled ? \"Send new transactions\" : \"Play again\"}\n        </span>\n      </div>\n    </div>\n  );\n}\n\nfunction Legend({ show }: { show: boolean }) {\n  if (!show) return null;\n  return (\n    <div className=\"popover bs-popover-bottom right show\">\n      <div className=\"arrow\" />\n      <div className=\"popover-body\">\n        <div className=\"d-flex flex-column\">\n          <div className=\"d-flex align-items-center mb-3\">\n            <div className=\"btn square legend slideInRight btn-dark mr-2\" />\n            <span>Pending transaction</span>\n          </div>\n\n          <div className=\"d-flex align-items-center mb-3\">\n            <div className=\"btn square legend slideInRight btn-primary mr-2\" />\n            <span>Confirmed transaction</span>\n          </div>\n\n          <div className=\"d-flex align-items-center\">\n            <div className=\"btn square legend slideInRight btn-danger mr-2\" />\n            <span>Failed transaction</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction HelpButton() {\n  const [show, setShow] = React.useState(false);\n\n  return (\n    <div\n      className=\"popover-container c-pointer mr-3\"\n      onClick={() => setShow(true)}\n      onMouseOver={() => setShow(true)}\n      onMouseOut={() => setShow(false)}\n    >\n      <span className=\"fe fe-help-circle\"></span>\n      <Legend show={show} />\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}