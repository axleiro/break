{"ast":null,"code":"import { CreateTransactionWorker } from \"./create-transaction-worker\";\nexport class CreateTransactionRPC {\n  constructor() {\n    this.worker = void 0;\n    this.callbacks = {};\n    this.worker = new CreateTransactionWorker();\n    this.worker.onmessage = this.handleMessages.bind(this);\n  }\n\n  handleMessages(event) {\n    let message = event.data;\n\n    if (message.trackingId in this.callbacks) {\n      let callbacks = this.callbacks[message.trackingId];\n      delete this.callbacks[message.trackingId];\n\n      if (\"error\" in message) {\n        callbacks[1](message.error);\n        return;\n      }\n\n      callbacks[0](message);\n    }\n  }\n\n  createTransaction(message) {\n    return new Promise((resolve, reject) => {\n      this.callbacks[message.trackingId] = [resolve, reject];\n      this.worker.postMessage(message);\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/jstarry/Workspace/solana/break/client/src/workers/create-transaction-rpc.ts"],"names":["CreateTransactionWorker","CreateTransactionRPC","constructor","worker","callbacks","onmessage","handleMessages","bind","event","message","data","trackingId","error","createTransaction","Promise","resolve","reject","postMessage"],"mappings":"AACA,SAASA,uBAAT,QAAwC,6BAAxC;AAsBA,OAAO,MAAMC,oBAAN,CAA2B;AAKhCC,EAAAA,WAAW,GAAG;AAAA,SAJNC,MAIM;AAAA,SAFNC,SAEM,GAF4C,EAE5C;AACZ,SAAKD,MAAL,GAAc,IAAIH,uBAAJ,EAAd;AACA,SAAKG,MAAL,CAAYE,SAAZ,GAAwB,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAAxB;AACD;;AAEDD,EAAAA,cAAc,CAACE,KAAD,EAAsB;AAClC,QAAIC,OAAO,GAAGD,KAAK,CAACE,IAApB;;AAEA,QAAID,OAAO,CAACE,UAAR,IAAsB,KAAKP,SAA/B,EAA0C;AACxC,UAAIA,SAAS,GAAG,KAAKA,SAAL,CAAeK,OAAO,CAACE,UAAvB,CAAhB;AACA,aAAO,KAAKP,SAAL,CAAeK,OAAO,CAACE,UAAvB,CAAP;;AAEA,UAAI,WAAWF,OAAf,EAAwB;AACtBL,QAAAA,SAAS,CAAC,CAAD,CAAT,CAAaK,OAAO,CAACG,KAArB;AACA;AACD;;AAEDR,MAAAA,SAAS,CAAC,CAAD,CAAT,CAAaK,OAAb;AACD;AACF;;AAEDI,EAAAA,iBAAiB,CACfJ,OADe,EAE4B;AAC3C,WAAO,IAAIK,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,WAAKZ,SAAL,CAAeK,OAAO,CAACE,UAAvB,IAAqC,CAACI,OAAD,EAAUC,MAAV,CAArC;AACA,WAAKb,MAAL,CAAYc,WAAZ,CAAwBR,OAAxB;AACD,KAHM,CAAP;AAID;;AAjC+B","sourcesContent":["import { Blockhash } from \"@solana/web3.js\";\nimport { CreateTransactionWorker } from \"./create-transaction-worker\";\n\nexport interface CreateTransactionMessage {\n  trackingId: number;\n  blockhash: Blockhash;\n  programId: string;\n  bitId: number;\n  feeAccountSecretKey: Buffer;\n  programDataAccount: string;\n}\n\nexport interface CreateTransactionResponseMessage {\n  trackingId: number;\n  signature: Buffer;\n  serializedTransaction: Buffer;\n}\n\nexport interface CreateTransactionErrorMessage {\n  trackingId: string;\n  error: Error;\n}\n\nexport class CreateTransactionRPC {\n  private worker: CreateTransactionWorker;\n\n  private callbacks: { [trackingId: string]: Function[] } = {};\n\n  constructor() {\n    this.worker = new CreateTransactionWorker();\n    this.worker.onmessage = this.handleMessages.bind(this);\n  }\n\n  handleMessages(event: MessageEvent) {\n    let message = event.data;\n\n    if (message.trackingId in this.callbacks) {\n      let callbacks = this.callbacks[message.trackingId];\n      delete this.callbacks[message.trackingId];\n\n      if (\"error\" in message) {\n        callbacks[1](message.error);\n        return;\n      }\n\n      callbacks[0](message);\n    }\n  }\n\n  createTransaction(\n    message: CreateTransactionMessage\n  ): Promise<CreateTransactionResponseMessage> {\n    return new Promise((resolve, reject) => {\n      this.callbacks[message.trackingId] = [resolve, reject];\n      this.worker.postMessage(message);\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}