{"ast":null,"code":"import _slicedToArray from\"/Users/jstarry/Workspace/solana/break/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import QRCode from\"qrcode.react\";import{LAMPORTS_PER_SOL}from\"@solana/web3.js\";import{useConfig,useRefreshAccounts}from\"providers/server/http\";import{useBalance}from\"providers/rpc/balance\";import{usePayerState}from\"providers/wallet\";export function lamportsToSolString(lamports){var maximumFractionDigits=arguments.length>1&&arguments[1]!==undefined?arguments[1]:9;var sol=Math.abs(lamports)/LAMPORTS_PER_SOL;return\"â—Ž\"+new Intl.NumberFormat(\"en-US\",{maximumFractionDigits:maximumFractionDigits}).format(sol);}export function getTrustWalletLink(address,amountSol){var iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;var android=/Android/i.test(navigator.userAgent);if(!iOS&&!android)return;var trustWalletDeepLink=\"https://link.trustwallet.com/send?coin=501&address=\".concat(address);// Only the iOS TW handles amount correctly at the moment\nif(iOS){trustWalletDeepLink+=\"&amount=\"+amountSol;}return trustWalletDeepLink;}export function PaymentCard(_ref){var _useConfig;var account=_ref.account;var balance=useBalance();var _usePayerState=usePayerState(),_usePayerState2=_slicedToArray(_usePayerState,2),setPayer=_usePayerState2[1];var gameCostLamports=((_useConfig=useConfig())===null||_useConfig===void 0?void 0:_useConfig.gameCost)||0;var gameCostSol=gameCostLamports/LAMPORTS_PER_SOL;var address=account.publicKey.toBase58();var balanceSufficient=balance!==\"loading\"&&balance>=gameCostLamports;var trustWalletDeepLink=getTrustWalletLink(address,gameCostSol);var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),copied=_React$useState2[0],setCopied=_React$useState2[1];var _React$useState3=React.useState(!trustWalletDeepLink),_React$useState4=_slicedToArray(_React$useState3,2),showQR=_React$useState4[0],setShowQR=_React$useState4[1];var copyAddress=function copyAddress(){navigator.clipboard.writeText(address);setCopied(true);};React.useEffect(function(){if(!copied)return;var timeoutId=setTimeout(function(){setCopied(false);},1000);return function(){return clearTimeout(timeoutId);};},[copied]);return/*#__PURE__*/React.createElement(\"div\",{className:\"card mb-0\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-header\"},/*#__PURE__*/React.createElement(\"h3\",{className:\"card-header-title font-weight-bold\"},\"Wallet\"),balance!==\"loading\"&&/*#__PURE__*/React.createElement(\"span\",{className:\"text-\".concat(balanceSufficient?\"primary\":\"warning\")},balanceSufficient?\"Press Play to Start\":trustWalletDeepLink?\"Add Funds to Play\":\"Transfer SOL to Play\")),/*#__PURE__*/React.createElement(\"div\",{className:\"card-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-between mb-4\"},/*#__PURE__*/React.createElement(\"div\",{className:\"font-weight-bold\"},\"Address\"),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"span\",{className:\"btn btn-sm btn-white\",onClick:copyAddress},/*#__PURE__*/React.createElement(\"span\",{className:\"fe fe-clipboard mr-2\"}),copied?\"Copied\":\"Copy\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex mb-4 pb-4 border-bottom\"},/*#__PURE__*/React.createElement(\"span\",{className:\"badge badge-dark overflow-hidden\"},/*#__PURE__*/React.createElement(\"h4\",{className:\"mb-0 text-truncate\"},address))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\"},/*#__PURE__*/React.createElement(\"div\",{className:\"font-weight-bold\"},\"QR Code\"),/*#__PURE__*/React.createElement(\"span\",{className:\"btn btn-sm btn-white ml-2\",onClick:function onClick(){return setShowQR(function(qr){return!qr;});}},showQR?\"Hide\":\"Show\")),showQR&&/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-center align-items-center mb-4 pb-4 border-bottom\"},/*#__PURE__*/React.createElement(QRCode,{value:\"solana:\".concat(address,\"?amount=\").concat(gameCostSol),includeMargin:true,bgColor:\"#000\",fgColor:\"#FFF\",renderAs:\"svg\",className:\"qr-code\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\"},/*#__PURE__*/React.createElement(\"div\",{className:\"font-weight-bold\"},\"Live Balance\"),/*#__PURE__*/React.createElement(\"span\",{className:\"badge badge-dark\"},/*#__PURE__*/React.createElement(\"h4\",{className:\"mb-0\"},balance===\"loading\"?/*#__PURE__*/React.createElement(\"span\",{className:\"spinner-grow spinner-grow-sm mr-2\"}):lamportsToSolString(balance)))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-between\"},/*#__PURE__*/React.createElement(\"div\",{className:\"font-weight-bold\"},\"Change Wallet\"),/*#__PURE__*/React.createElement(\"span\",{className:\"btn btn-sm btn-white\",onClick:function onClick(){return setPayer(undefined);}},/*#__PURE__*/React.createElement(\"span\",{className:\"fe fe-list mr-2\"}),\"List\")),trustWalletDeepLink&&/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center justify-content-between mt-4 pt-4 border-top\"},/*#__PURE__*/React.createElement(\"div\",{className:\"font-weight-bold\"},\"Add Funds\"),/*#__PURE__*/React.createElement(\"a\",{className:\"btn btn-sm btn-info\",href:trustWalletDeepLink,target:\"_blank\",rel:\"noopener noreferrer\"},/*#__PURE__*/React.createElement(\"span\",{className:\"fe fe-external-link mr-2\"}),\"Open Trust Wallet\"))),/*#__PURE__*/React.createElement(Footer,null));}function Footer(){var _useConfig2;var balance=useBalance();var gameCostLamports=((_useConfig2=useConfig())===null||_useConfig2===void 0?void 0:_useConfig2.gameCost)||0;var refreshAccounts=useRefreshAccounts();var sufficient=balance>=gameCostLamports;return/*#__PURE__*/React.createElement(\"div\",{className:\"card-footer d-flex flex-column align-items-center\"},/*#__PURE__*/React.createElement(\"input\",{type:\"button\",value:\"Play\",disabled:!sufficient,className:\"btn btn-pink w-100 text-uppercase\",onClick:refreshAccounts}),/*#__PURE__*/React.createElement(\"span\",{className:\"text-muted small mt-2\"},\"One play costs \",lamportsToSolString(gameCostLamports)));}","map":{"version":3,"sources":["/Users/jstarry/Workspace/solana/break/client/src/components/PaymentCard.tsx"],"names":["React","QRCode","LAMPORTS_PER_SOL","useConfig","useRefreshAccounts","useBalance","usePayerState","lamportsToSolString","lamports","maximumFractionDigits","sol","Math","abs","Intl","NumberFormat","format","getTrustWalletLink","address","amountSol","iOS","test","navigator","userAgent","window","MSStream","android","trustWalletDeepLink","PaymentCard","account","balance","setPayer","gameCostLamports","gameCost","gameCostSol","publicKey","toBase58","balanceSufficient","useState","copied","setCopied","showQR","setShowQR","copyAddress","clipboard","writeText","useEffect","timeoutId","setTimeout","clearTimeout","qr","undefined","Footer","refreshAccounts","sufficient"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport QRCode from \"qrcode.react\";\nimport { Account, LAMPORTS_PER_SOL } from \"@solana/web3.js\";\n\nimport { useConfig, useRefreshAccounts } from \"providers/server/http\";\nimport { useBalance } from \"providers/rpc/balance\";\nimport { usePayerState } from \"providers/wallet\";\n\nexport function lamportsToSolString(\n  lamports: number,\n  maximumFractionDigits: number = 9\n): string {\n  const sol = Math.abs(lamports) / LAMPORTS_PER_SOL;\n  return (\n    \"â—Ž\" + new Intl.NumberFormat(\"en-US\", { maximumFractionDigits }).format(sol)\n  );\n}\n\nexport function getTrustWalletLink(\n  address: string,\n  amountSol: number\n): string | undefined {\n  const iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n  const android = /Android/i.test(navigator.userAgent);\n  if (!iOS && !android) return;\n\n  let trustWalletDeepLink = `https://link.trustwallet.com/send?coin=501&address=${address}`;\n\n  // Only the iOS TW handles amount correctly at the moment\n  if (iOS) {\n    trustWalletDeepLink += \"&amount=\" + amountSol;\n  }\n\n  return trustWalletDeepLink;\n}\n\nexport function PaymentCard({ account }: { account: Account }) {\n  const balance = useBalance();\n  const [, setPayer] = usePayerState();\n  const gameCostLamports = useConfig()?.gameCost || 0;\n  const gameCostSol = gameCostLamports / LAMPORTS_PER_SOL;\n  const address = account.publicKey.toBase58();\n  const balanceSufficient =\n    balance !== \"loading\" && balance >= gameCostLamports;\n  const trustWalletDeepLink = getTrustWalletLink(address, gameCostSol);\n  const [copied, setCopied] = React.useState(false);\n  const [showQR, setShowQR] = React.useState(!trustWalletDeepLink);\n\n  const copyAddress = () => {\n    navigator.clipboard.writeText(address);\n    setCopied(true);\n  };\n\n  React.useEffect(() => {\n    if (!copied) return;\n    const timeoutId = setTimeout(() => {\n      setCopied(false);\n    }, 1000);\n    return () => clearTimeout(timeoutId);\n  }, [copied]);\n\n  return (\n    <div className=\"card mb-0\">\n      <div className=\"card-header\">\n        <h3 className=\"card-header-title font-weight-bold\">Wallet</h3>\n        {balance !== \"loading\" && (\n          <span className={`text-${balanceSufficient ? \"primary\" : \"warning\"}`}>\n            {balanceSufficient\n              ? \"Press Play to Start\"\n              : trustWalletDeepLink\n              ? \"Add Funds to Play\"\n              : \"Transfer SOL to Play\"}\n          </span>\n        )}\n      </div>\n\n      <div className=\"card-body\">\n        <div className=\"d-flex align-items-center justify-content-between mb-4\">\n          <div className=\"font-weight-bold\">Address</div>\n          <div>\n            <span className=\"btn btn-sm btn-white\" onClick={copyAddress}>\n              <span className=\"fe fe-clipboard mr-2\"></span>\n              {copied ? \"Copied\" : \"Copy\"}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"d-flex mb-4 pb-4 border-bottom\">\n          <span className=\"badge badge-dark overflow-hidden\">\n            <h4 className=\"mb-0 text-truncate\">{address}</h4>\n          </span>\n        </div>\n\n        <div className=\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\">\n          <div className=\"font-weight-bold\">QR Code</div>\n          <span\n            className=\"btn btn-sm btn-white ml-2\"\n            onClick={() => setShowQR((qr) => !qr)}\n          >\n            {showQR ? \"Hide\" : \"Show\"}\n          </span>\n        </div>\n\n        {showQR && (\n          <div className=\"d-flex justify-content-center align-items-center mb-4 pb-4 border-bottom\">\n            <QRCode\n              value={`solana:${address}?amount=${gameCostSol}`}\n              includeMargin\n              bgColor=\"#000\"\n              fgColor=\"#FFF\"\n              renderAs=\"svg\"\n              className=\"qr-code\"\n            />\n          </div>\n        )}\n\n        <div className=\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\">\n          <div className=\"font-weight-bold\">Live Balance</div>\n          <span className=\"badge badge-dark\">\n            <h4 className=\"mb-0\">\n              {balance === \"loading\" ? (\n                <span className=\"spinner-grow spinner-grow-sm mr-2\"></span>\n              ) : (\n                lamportsToSolString(balance)\n              )}\n            </h4>\n          </span>\n        </div>\n\n        <div className=\"d-flex align-items-center justify-content-between\">\n          <div className=\"font-weight-bold\">Change Wallet</div>\n          <span\n            className=\"btn btn-sm btn-white\"\n            onClick={() => setPayer(undefined)}\n          >\n            <span className=\"fe fe-list mr-2\"></span>\n            List\n          </span>\n        </div>\n\n        {trustWalletDeepLink && (\n          <div className=\"d-flex align-items-center justify-content-between mt-4 pt-4 border-top\">\n            <div className=\"font-weight-bold\">Add Funds</div>\n            <a\n              className=\"btn btn-sm btn-info\"\n              href={trustWalletDeepLink}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <span className=\"fe fe-external-link mr-2\"></span>\n              Open Trust Wallet\n            </a>\n          </div>\n        )}\n      </div>\n      <Footer />\n    </div>\n  );\n}\n\nfunction Footer() {\n  const balance = useBalance();\n  const gameCostLamports = useConfig()?.gameCost || 0;\n  const refreshAccounts = useRefreshAccounts();\n\n  const sufficient = balance >= gameCostLamports;\n  return (\n    <div className=\"card-footer d-flex flex-column align-items-center\">\n      <input\n        type=\"button\"\n        value=\"Play\"\n        disabled={!sufficient}\n        className=\"btn btn-pink w-100 text-uppercase\"\n        onClick={refreshAccounts}\n      />\n      <span className=\"text-muted small mt-2\">\n        One play costs {lamportsToSolString(gameCostLamports)}\n      </span>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}