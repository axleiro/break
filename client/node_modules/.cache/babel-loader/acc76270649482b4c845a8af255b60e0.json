{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/jstarry/Workspace/solana/break/client/src/components/PaymentCard.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React from \"react\";\nimport QRCode from \"qrcode.react\";\nimport { LAMPORTS_PER_SOL, PublicKey, sendAndConfirmTransaction, SystemProgram, Transaction } from \"@solana/web3.js\";\nimport { useConfig, useRefreshAccounts } from \"providers/server/http\";\nimport { useBalance } from \"providers/rpc/balance\";\nimport { usePayerState } from \"providers/wallet\";\nimport { useConnection } from \"providers/rpc\";\nimport { useBlockhash } from \"providers/rpc/blockhash\";\nexport function lamportsToSolString(lamports, maximumFractionDigits = 9) {\n  const sol = Math.abs(lamports) / LAMPORTS_PER_SOL;\n  return \"◎\" + new Intl.NumberFormat(\"en-US\", {\n    maximumFractionDigits\n  }).format(sol);\n}\nexport function getTrustWalletLink(address, amountSol) {\n  const iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n  const android = /Android/i.test(navigator.userAgent);\n  if (!iOS && !android) return;\n  let trustWalletDeepLink = `https://link.trustwallet.com/send?coin=501&address=${address}`; // Only the iOS TW handles amount correctly at the moment\n\n  if (iOS) {\n    trustWalletDeepLink += \"&amount=\" + amountSol;\n  }\n\n  return trustWalletDeepLink;\n}\nexport function PaymentCard({\n  account\n}) {\n  _s();\n\n  var _useConfig;\n\n  const balance = useBalance();\n  const connection = useConnection();\n  const recentBlockhash = useBlockhash();\n  const [, setPayer] = usePayerState();\n  const gameCostLamports = ((_useConfig = useConfig()) === null || _useConfig === void 0 ? void 0 : _useConfig.gameCost) || 0;\n  const gameCostSol = gameCostLamports / LAMPORTS_PER_SOL;\n  const address = account.publicKey.toBase58();\n  const balanceSufficient = balance !== \"loading\" && balance >= gameCostLamports;\n  const trustWalletDeepLink = getTrustWalletLink(address, gameCostSol);\n  const [copied, setCopied] = React.useState(false);\n  const [showQR, setShowQR] = React.useState(!trustWalletDeepLink);\n  const [showWithdraw, setShowWithdraw] = React.useState(false);\n  const [toPubkey, setToPubkey] = React.useState();\n  const [withdrawMessage, setWithdrawMessage] = React.useState(\"\");\n\n  const copyAddress = () => {\n    navigator.clipboard.writeText(address);\n    setCopied(true);\n  };\n\n  const updateToPubkey = event => {\n    try {\n      setToPubkey(new PublicKey(event.currentTarget.value));\n    } catch (err) {\n      setToPubkey(undefined);\n    }\n  };\n\n  const withdrawEnabled = React.useMemo(() => {\n    return connection && recentBlockhash && toPubkey && typeof balance === \"number\";\n  }, [connection, recentBlockhash, toPubkey]);\n  const withdrawFunds = React.useCallback(() => {\n    if (connection && recentBlockhash && toPubkey && typeof balance === \"number\") {\n      (async () => {\n        try {\n          await sendAndConfirmTransaction(connection, new Transaction({\n            recentBlockhash\n          }).add(SystemProgram.transfer({\n            fromPubkey: account.publicKey,\n            toPubkey,\n            lamports: balance\n          })), [account]);\n        } catch (err) {\n          console.error(err);\n          setWithdrawMessage(\"Withdraw failed\");\n        }\n      })();\n    }\n  }, [connection, recentBlockhash, toPubkey]);\n  React.useEffect(() => {\n    if (!copied) return;\n    const timeoutId = setTimeout(() => {\n      setCopied(false);\n    }, 1000);\n    return () => clearTimeout(timeoutId);\n  }, [copied]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"card mb-0\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"card-header-title font-weight-bold\",\n        children: \"Wallet\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), balance !== \"loading\" && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: `text-${balanceSufficient ? \"primary\" : \"warning\"}`,\n        children: balanceSufficient ? \"Press Play to Start\" : trustWalletDeepLink ? \"Add Funds to Play\" : \"Transfer SOL to Play\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card-body\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex align-items-center justify-content-between mb-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-weight-bold\",\n          children: \"Address\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"btn btn-sm btn-white\",\n            onClick: copyAddress,\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"fe fe-clipboard mr-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 118,\n              columnNumber: 15\n            }, this), copied ? \"Copied\" : \"Copy\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex mb-4 pb-4 border-bottom\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"badge badge-dark overflow-hidden\",\n          children: /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"mb-0 text-truncate\",\n            children: address\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-weight-bold\",\n          children: \"QR Code\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"btn btn-sm btn-white ml-2\",\n          onClick: () => setShowQR(qr => !qr),\n          children: showQR ? \"Hide\" : \"Show\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this), showQR && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex justify-content-center align-items-center mb-4 pb-4 border-bottom\",\n        children: /*#__PURE__*/_jsxDEV(QRCode, {\n          value: `solana:${address}?amount=${gameCostSol}`,\n          includeMargin: true,\n          bgColor: \"#000\",\n          fgColor: \"#FFF\",\n          renderAs: \"svg\",\n          className: \"qr-code\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-weight-bold\",\n          children: \"Live Balance\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"badge badge-dark\",\n          children: /*#__PURE__*/_jsxDEV(\"h4\", {\n            className: \"mb-0\",\n            children: balance === \"loading\" ? /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"spinner-grow spinner-grow-sm mr-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 158,\n              columnNumber: 17\n            }, this) : lamportsToSolString(balance)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-weight-bold\",\n          children: \"Withdraw Funds\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"btn btn-sm btn-white\",\n          onClick: () => setShowWithdraw(show => !show),\n          children: showWithdraw ? \"Cancel\" : \"Withdraw\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }, this), showWithdraw && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-4 pb-4 border-bottom\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex align-items-center justify-content-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"To Address\",\n            onInput: updateToPubkey\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"button\",\n            value: \"Withdraw\",\n            disabled: !withdrawEnabled,\n            onClick: () => withdrawFunds()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 13\n        }, this), withdrawMessage && /*#__PURE__*/_jsxDEV(\"span\", {\n          children: withdrawMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 34\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex align-items-center justify-content-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-weight-bold\",\n          children: \"Change Wallet\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"btn btn-sm btn-white\",\n          onClick: () => setPayer(undefined),\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"fe fe-list mr-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 13\n          }, this), \"List\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }, this), trustWalletDeepLink && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex align-items-center justify-content-between mt-4 pt-4 border-top\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-weight-bold\",\n          children: \"Add Funds\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n          className: \"btn btn-sm btn-info\",\n          href: trustWalletDeepLink,\n          target: \"_blank\",\n          rel: \"noopener noreferrer\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"fe fe-external-link mr-2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 206,\n            columnNumber: 15\n          }, this), \"Open Trust Wallet\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 5\n  }, this);\n}\n\n_s(PaymentCard, \"sN1AZxwo2Q0Ysq9GYxpKw2kyaE8=\", false, function () {\n  return [useBalance, useConnection, useBlockhash, usePayerState, useConfig];\n});\n\n_c = PaymentCard;\n\nfunction Footer() {\n  _s2();\n\n  var _useConfig2;\n\n  const balance = useBalance();\n  const gameCostLamports = ((_useConfig2 = useConfig()) === null || _useConfig2 === void 0 ? void 0 : _useConfig2.gameCost) || 0;\n  const refreshAccounts = useRefreshAccounts();\n  const sufficient = balance >= gameCostLamports;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"card-footer d-flex flex-column align-items-center\",\n    children: [/*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"button\",\n      value: \"Play\",\n      disabled: !sufficient,\n      className: \"btn btn-pink w-100 text-uppercase\",\n      onClick: refreshAccounts\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"text-muted small mt-2\",\n      children: [\"One play costs \", lamportsToSolString(gameCostLamports)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 224,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(Footer, \"/7CNUtMsP7kSWBGgiTzmPq19KKc=\", false, function () {\n  return [useBalance, useConfig, useRefreshAccounts];\n});\n\n_c2 = Footer;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"PaymentCard\");\n$RefreshReg$(_c2, \"Footer\");","map":{"version":3,"sources":["/Users/jstarry/Workspace/solana/break/client/src/components/PaymentCard.tsx"],"names":["React","QRCode","LAMPORTS_PER_SOL","PublicKey","sendAndConfirmTransaction","SystemProgram","Transaction","useConfig","useRefreshAccounts","useBalance","usePayerState","useConnection","useBlockhash","lamportsToSolString","lamports","maximumFractionDigits","sol","Math","abs","Intl","NumberFormat","format","getTrustWalletLink","address","amountSol","iOS","test","navigator","userAgent","window","MSStream","android","trustWalletDeepLink","PaymentCard","account","balance","connection","recentBlockhash","setPayer","gameCostLamports","gameCost","gameCostSol","publicKey","toBase58","balanceSufficient","copied","setCopied","useState","showQR","setShowQR","showWithdraw","setShowWithdraw","toPubkey","setToPubkey","withdrawMessage","setWithdrawMessage","copyAddress","clipboard","writeText","updateToPubkey","event","currentTarget","value","err","undefined","withdrawEnabled","useMemo","withdrawFunds","useCallback","add","transfer","fromPubkey","console","error","useEffect","timeoutId","setTimeout","clearTimeout","qr","show","Footer","refreshAccounts","sufficient"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport QRCode from \"qrcode.react\";\nimport { Account, LAMPORTS_PER_SOL, PublicKey, sendAndConfirmTransaction, SystemInstruction, SystemProgram, Transaction } from \"@solana/web3.js\";\n\nimport { useConfig, useRefreshAccounts } from \"providers/server/http\";\nimport { useBalance } from \"providers/rpc/balance\";\nimport { usePayerState } from \"providers/wallet\";\nimport { useConnection } from \"providers/rpc\";\nimport { useBlockhash } from \"providers/rpc/blockhash\";\n\nexport function lamportsToSolString(\n  lamports: number,\n  maximumFractionDigits: number = 9\n): string {\n  const sol = Math.abs(lamports) / LAMPORTS_PER_SOL;\n  return (\n    \"◎\" + new Intl.NumberFormat(\"en-US\", { maximumFractionDigits }).format(sol)\n  );\n}\n\nexport function getTrustWalletLink(\n  address: string,\n  amountSol: number\n): string | undefined {\n  const iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n  const android = /Android/i.test(navigator.userAgent);\n  if (!iOS && !android) return;\n\n  let trustWalletDeepLink = `https://link.trustwallet.com/send?coin=501&address=${address}`;\n\n  // Only the iOS TW handles amount correctly at the moment\n  if (iOS) {\n    trustWalletDeepLink += \"&amount=\" + amountSol;\n  }\n\n  return trustWalletDeepLink;\n}\n\nexport function PaymentCard({ account }: { account: Account }) {\n  const balance = useBalance();\n  const connection = useConnection();\n  const recentBlockhash = useBlockhash();\n  const [, setPayer] = usePayerState();\n  const gameCostLamports = useConfig()?.gameCost || 0;\n  const gameCostSol = gameCostLamports / LAMPORTS_PER_SOL;\n  const address = account.publicKey.toBase58();\n  const balanceSufficient =\n    balance !== \"loading\" && balance >= gameCostLamports;\n  const trustWalletDeepLink = getTrustWalletLink(address, gameCostSol);\n  const [copied, setCopied] = React.useState(false);\n  const [showQR, setShowQR] = React.useState(!trustWalletDeepLink);\n  const [showWithdraw, setShowWithdraw] = React.useState(false);\n  const [toPubkey, setToPubkey] = React.useState<PublicKey>();\n  const [withdrawMessage, setWithdrawMessage] = React.useState(\"\");\n\n  const copyAddress = () => {\n    navigator.clipboard.writeText(address);\n    setCopied(true);\n  };\n\n  const updateToPubkey = (event: React.FormEvent<HTMLInputElement>) => {\n    try {\n      setToPubkey(new PublicKey(event.currentTarget.value));\n    } catch (err) {\n      setToPubkey(undefined);\n    }\n  };\n\n  const withdrawEnabled = React.useMemo(() => {\n    return connection && recentBlockhash && toPubkey && typeof balance === \"number\";\n  }, [connection, recentBlockhash, toPubkey]);\n\n  const withdrawFunds = React.useCallback(() => {\n    if (connection && recentBlockhash && toPubkey && typeof balance === \"number\") {\n      (async () => {\n        try {\n          await sendAndConfirmTransaction(connection, new Transaction({recentBlockhash}).add(SystemProgram.transfer({\n            fromPubkey: account.publicKey,\n            toPubkey,\n            lamports: balance,\n          })), [account]);\n        } catch (err) {\n          console.error(err);\n          setWithdrawMessage(\"Withdraw failed\");\n        }\n      })();\n    }\n  }, [connection, recentBlockhash, toPubkey]);\n\n  React.useEffect(() => {\n    if (!copied) return;\n    const timeoutId = setTimeout(() => {\n      setCopied(false);\n    }, 1000);\n    return () => clearTimeout(timeoutId);\n  }, [copied]);\n\n  return (\n    <div className=\"card mb-0\">\n      <div className=\"card-header\">\n        <h3 className=\"card-header-title font-weight-bold\">Wallet</h3>\n        {balance !== \"loading\" && (\n          <span className={`text-${balanceSufficient ? \"primary\" : \"warning\"}`}>\n            {balanceSufficient\n              ? \"Press Play to Start\"\n              : trustWalletDeepLink\n              ? \"Add Funds to Play\"\n              : \"Transfer SOL to Play\"}\n          </span>\n        )}\n      </div>\n\n      <div className=\"card-body\">\n        <div className=\"d-flex align-items-center justify-content-between mb-4\">\n          <div className=\"font-weight-bold\">Address</div>\n          <div>\n            <span className=\"btn btn-sm btn-white\" onClick={copyAddress}>\n              <span className=\"fe fe-clipboard mr-2\"></span>\n              {copied ? \"Copied\" : \"Copy\"}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"d-flex mb-4 pb-4 border-bottom\">\n          <span className=\"badge badge-dark overflow-hidden\">\n            <h4 className=\"mb-0 text-truncate\">{address}</h4>\n          </span>\n        </div>\n\n        <div className=\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\">\n          <div className=\"font-weight-bold\">QR Code</div>\n          <span\n            className=\"btn btn-sm btn-white ml-2\"\n            onClick={() => setShowQR((qr) => !qr)}\n          >\n            {showQR ? \"Hide\" : \"Show\"}\n          </span>\n        </div>\n\n        {showQR && (\n          <div className=\"d-flex justify-content-center align-items-center mb-4 pb-4 border-bottom\">\n            <QRCode\n              value={`solana:${address}?amount=${gameCostSol}`}\n              includeMargin\n              bgColor=\"#000\"\n              fgColor=\"#FFF\"\n              renderAs=\"svg\"\n              className=\"qr-code\"\n            />\n          </div>\n        )}\n\n        <div className=\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\">\n          <div className=\"font-weight-bold\">Live Balance</div>\n          <span className=\"badge badge-dark\">\n            <h4 className=\"mb-0\">\n              {balance === \"loading\" ? (\n                <span className=\"spinner-grow spinner-grow-sm mr-2\"></span>\n              ) : (\n                lamportsToSolString(balance)\n              )}\n            </h4>\n          </span>\n        </div>\n\n        <div className=\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\">\n          <div className=\"font-weight-bold\">Withdraw Funds</div>\n          <span\n            className=\"btn btn-sm btn-white\"\n            onClick={() => setShowWithdraw((show) => !show)}\n          >\n            {showWithdraw ? \"Cancel\" : \"Withdraw\"}\n          </span>\n        </div>\n\n        {showWithdraw && (\n          <div className=\"mb-4 pb-4 border-bottom\">\n            <div className=\"d-flex align-items-center justify-content-between\">\n              <input type=\"text\" placeholder=\"To Address\" onInput={updateToPubkey} />\n              <input type=\"button\" value=\"Withdraw\" disabled={!withdrawEnabled} onClick={() => withdrawFunds()} />\n            </div>\n            {withdrawMessage && (<span>{withdrawMessage}</span>)}\n          </div>\n        )}\n\n        <div className=\"d-flex align-items-center justify-content-between\">\n          <div className=\"font-weight-bold\">Change Wallet</div>\n          <span\n            className=\"btn btn-sm btn-white\"\n            onClick={() => setPayer(undefined)}\n          >\n            <span className=\"fe fe-list mr-2\"></span>\n            List\n          </span>\n        </div>\n\n        {trustWalletDeepLink && (\n          <div className=\"d-flex align-items-center justify-content-between mt-4 pt-4 border-top\">\n            <div className=\"font-weight-bold\">Add Funds</div>\n            <a\n              className=\"btn btn-sm btn-info\"\n              href={trustWalletDeepLink}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <span className=\"fe fe-external-link mr-2\"></span>\n              Open Trust Wallet\n            </a>\n          </div>\n        )}\n      </div>\n      <Footer />\n    </div>\n  );\n}\n\nfunction Footer() {\n  const balance = useBalance();\n  const gameCostLamports = useConfig()?.gameCost || 0;\n  const refreshAccounts = useRefreshAccounts();\n\n  const sufficient = balance >= gameCostLamports;\n  return (\n    <div className=\"card-footer d-flex flex-column align-items-center\">\n      <input\n        type=\"button\"\n        value=\"Play\"\n        disabled={!sufficient}\n        className=\"btn btn-pink w-100 text-uppercase\"\n        onClick={refreshAccounts}\n      />\n      <span className=\"text-muted small mt-2\">\n        One play costs {lamportsToSolString(gameCostLamports)}\n      </span>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}