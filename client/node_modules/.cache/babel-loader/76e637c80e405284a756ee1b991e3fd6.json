{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jstarry/Workspace/solana/break/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jstarry/Workspace/solana/break/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/jstarry/Workspace/solana/break/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import QRCode from\"qrcode.react\";import{LAMPORTS_PER_SOL,PublicKey,sendAndConfirmTransaction,SystemProgram,Transaction}from\"@solana/web3.js\";import{useConfig,useRefreshAccounts}from\"providers/server/http\";import{useBalance}from\"providers/rpc/balance\";import{usePayerState}from\"providers/wallet\";import{useConnection}from\"providers/rpc\";import{useBlockhash}from\"providers/rpc/blockhash\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export function lamportsToSolString(lamports){var maximumFractionDigits=arguments.length>1&&arguments[1]!==undefined?arguments[1]:9;var sol=Math.abs(lamports)/LAMPORTS_PER_SOL;return\"◎\"+new Intl.NumberFormat(\"en-US\",{maximumFractionDigits:maximumFractionDigits}).format(sol);}export function getTrustWalletLink(address,amountSol){var iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;var android=/Android/i.test(navigator.userAgent);if(!iOS&&!android)return;var trustWalletDeepLink=\"https://link.trustwallet.com/send?coin=501&address=\".concat(address);// Only the iOS TW handles amount correctly at the moment\nif(iOS){trustWalletDeepLink+=\"&amount=\"+amountSol;}return trustWalletDeepLink;}export function PaymentCard(_ref){var _useConfig;var account=_ref.account;var balance=useBalance();var connection=useConnection();var recentBlockhash=useBlockhash();var _usePayerState=usePayerState(),_usePayerState2=_slicedToArray(_usePayerState,2),setPayer=_usePayerState2[1];var gameCostLamports=((_useConfig=useConfig())===null||_useConfig===void 0?void 0:_useConfig.gameCost)||0;var gameCostSol=gameCostLamports/LAMPORTS_PER_SOL;var address=account.publicKey.toBase58();var balanceSufficient=balance!==\"loading\"&&balance>=gameCostLamports;var trustWalletDeepLink=getTrustWalletLink(address,gameCostSol);var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),copied=_React$useState2[0],setCopied=_React$useState2[1];var _React$useState3=React.useState(!trustWalletDeepLink),_React$useState4=_slicedToArray(_React$useState3,2),showQR=_React$useState4[0],setShowQR=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),showWithdraw=_React$useState6[0],setShowWithdraw=_React$useState6[1];var _React$useState7=React.useState(),_React$useState8=_slicedToArray(_React$useState7,2),toPubkey=_React$useState8[0],setToPubkey=_React$useState8[1];var _React$useState9=React.useState(\"\"),_React$useState10=_slicedToArray(_React$useState9,2),withdrawMessage=_React$useState10[0],setWithdrawMessage=_React$useState10[1];var copyAddress=function copyAddress(){navigator.clipboard.writeText(address);setCopied(true);};var updateToPubkey=function updateToPubkey(event){setWithdrawMessage(\"\");try{setToPubkey(new PublicKey(event.currentTarget.value));}catch(err){setToPubkey(undefined);}};var withdrawEnabled=React.useMemo(function(){return connection&&recentBlockhash&&toPubkey&&typeof balance===\"number\";},[connection,recentBlockhash,toPubkey,balance]);var withdrawFunds=React.useCallback(function(){if(connection&&recentBlockhash&&toPubkey&&typeof balance===\"number\"){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return sendAndConfirmTransaction(connection,new Transaction({recentBlockhash:recentBlockhash}).add(SystemProgram.transfer({fromPubkey:account.publicKey,toPubkey:toPubkey,lamports:balance-5000})),[account],{commitment:\"singleGossip\",preflightCommitment:\"singleGossip\"});case 3:setWithdrawMessage(\"Withdraw succeeded\");_context.next=10;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);console.error(_context.t0);setWithdrawMessage(\"Withdraw failed\");case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);}))();}},[account,balance,connection,recentBlockhash,toPubkey]);React.useEffect(function(){if(!copied)return;var timeoutId=setTimeout(function(){setCopied(false);},1000);return function(){return clearTimeout(timeoutId);};},[copied]);return/*#__PURE__*/_jsxs(\"div\",{className:\"card mb-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"card-header-title font-weight-bold\",children:\"Wallet\"}),balance!==\"loading\"&&/*#__PURE__*/_jsx(\"span\",{className:\"text-\".concat(balanceSufficient?\"primary\":\"warning\"),children:balanceSufficient?\"Press Play to Start\":trustWalletDeepLink?\"Add Funds to Play\":\"Transfer SOL to Play\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-weight-bold\",children:\"Address\"}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"span\",{className:\"btn btn-sm btn-white\",onClick:copyAddress,children:[/*#__PURE__*/_jsx(\"span\",{className:\"fe fe-clipboard mr-2\"}),copied?\"Copied\":\"Copy\"]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"d-flex mb-4 pb-4 border-bottom\",children:/*#__PURE__*/_jsx(\"span\",{className:\"badge badge-dark overflow-hidden\",children:/*#__PURE__*/_jsx(\"h4\",{className:\"mb-0 text-truncate\",children:address})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-weight-bold\",children:\"QR Code\"}),/*#__PURE__*/_jsx(\"span\",{className:\"btn btn-sm btn-white ml-2\",onClick:function onClick(){return setShowQR(function(qr){return!qr;});},children:showQR?\"Hide\":\"Show\"})]}),showQR&&/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center align-items-center mb-4 pb-4 border-bottom\",children:/*#__PURE__*/_jsx(QRCode,{value:\"solana:\".concat(address,\"?amount=\").concat(gameCostSol),includeMargin:true,bgColor:\"#000\",fgColor:\"#FFF\",renderAs:\"svg\",className:\"qr-code\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-weight-bold\",children:\"Live Balance\"}),/*#__PURE__*/_jsx(\"span\",{className:\"badge badge-dark\",children:/*#__PURE__*/_jsx(\"h4\",{className:\"mb-0\",children:balance===\"loading\"?/*#__PURE__*/_jsx(\"span\",{className:\"spinner-grow spinner-grow-sm mr-2\"}):lamportsToSolString(balance)})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-weight-bold\",children:\"Withdraw Funds\"}),/*#__PURE__*/_jsx(\"span\",{className:\"btn btn-sm btn-white\",onClick:function onClick(){setShowWithdraw(function(show){return!show;});setWithdrawMessage(\"\");},children:showWithdraw?\"Hide\":\"Withdraw\"})]}),showWithdraw&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 pb-4 border-bottom\",children:[withdrawMessage&&/*#__PURE__*/_jsx(\"p\",{children:withdrawMessage}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",style:{flex:1,maxWidth:\"500px\"},placeholder:\"To Address\",onInput:updateToPubkey}),/*#__PURE__*/_jsx(\"input\",{className:\"btn btn-sm btn-white ml-2\",type:\"button\",value:\"Withdraw\",disabled:!withdrawEnabled,onClick:function onClick(){return withdrawFunds();}})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-weight-bold\",children:\"Change Wallet\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"btn btn-sm btn-white\",onClick:function onClick(){return setPayer(undefined);},children:[/*#__PURE__*/_jsx(\"span\",{className:\"fe fe-list mr-2\"}),\"List\"]})]}),trustWalletDeepLink&&/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center justify-content-between mt-4 pt-4 border-top\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-weight-bold\",children:\"Add Funds\"}),/*#__PURE__*/_jsxs(\"a\",{className:\"btn btn-sm btn-info\",href:trustWalletDeepLink,target:\"_blank\",rel:\"noopener noreferrer\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"fe fe-external-link mr-2\"}),\"Open Trust Wallet\"]})]})]}),/*#__PURE__*/_jsx(Footer,{})]});}function Footer(){var _useConfig2;var balance=useBalance();var gameCostLamports=((_useConfig2=useConfig())===null||_useConfig2===void 0?void 0:_useConfig2.gameCost)||0;var refreshAccounts=useRefreshAccounts();var sufficient=balance>=gameCostLamports;return/*#__PURE__*/_jsxs(\"div\",{className:\"card-footer d-flex flex-column align-items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"button\",value:\"Play\",disabled:!sufficient,className:\"btn btn-pink w-100 text-uppercase\",onClick:refreshAccounts}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-muted small mt-2\",children:[\"One play costs \",lamportsToSolString(gameCostLamports)]})]});}","map":{"version":3,"sources":["/Users/jstarry/Workspace/solana/break/client/src/components/PaymentCard.tsx"],"names":["React","QRCode","LAMPORTS_PER_SOL","PublicKey","sendAndConfirmTransaction","SystemProgram","Transaction","useConfig","useRefreshAccounts","useBalance","usePayerState","useConnection","useBlockhash","lamportsToSolString","lamports","maximumFractionDigits","sol","Math","abs","Intl","NumberFormat","format","getTrustWalletLink","address","amountSol","iOS","test","navigator","userAgent","window","MSStream","android","trustWalletDeepLink","PaymentCard","account","balance","connection","recentBlockhash","setPayer","gameCostLamports","gameCost","gameCostSol","publicKey","toBase58","balanceSufficient","useState","copied","setCopied","showQR","setShowQR","showWithdraw","setShowWithdraw","toPubkey","setToPubkey","withdrawMessage","setWithdrawMessage","copyAddress","clipboard","writeText","updateToPubkey","event","currentTarget","value","err","undefined","withdrawEnabled","useMemo","withdrawFunds","useCallback","add","transfer","fromPubkey","commitment","preflightCommitment","console","error","useEffect","timeoutId","setTimeout","clearTimeout","qr","show","flex","maxWidth","Footer","refreshAccounts","sufficient"],"mappings":"seAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,MAAP,KAAmB,cAAnB,CACA,OAEEC,gBAFF,CAGEC,SAHF,CAIEC,yBAJF,CAKEC,aALF,CAMEC,WANF,KAOO,iBAPP,CASA,OAASC,SAAT,CAAoBC,kBAApB,KAA8C,uBAA9C,CACA,OAASC,UAAT,KAA2B,uBAA3B,CACA,OAASC,aAAT,KAA8B,kBAA9B,CACA,OAASC,aAAT,KAA8B,eAA9B,CACA,OAASC,YAAT,KAA6B,yBAA7B,C,wFAEA,MAAO,SAASC,CAAAA,mBAAT,CACLC,QADK,CAGG,IADRC,CAAAA,qBACQ,2DADwB,CACxB,CACR,GAAMC,CAAAA,GAAG,CAAGC,IAAI,CAACC,GAAL,CAASJ,QAAT,EAAqBZ,gBAAjC,CACA,MACE,IAAM,GAAIiB,CAAAA,IAAI,CAACC,YAAT,CAAsB,OAAtB,CAA+B,CAAEL,qBAAqB,CAArBA,qBAAF,CAA/B,EAA0DM,MAA1D,CAAiEL,GAAjE,CADR,CAGD,CAED,MAAO,SAASM,CAAAA,kBAAT,CACLC,OADK,CAELC,SAFK,CAGe,CACpB,GAAMC,CAAAA,GAAG,CAAG,mBAAmBC,IAAnB,CAAwBC,SAAS,CAACC,SAAlC,GAAgD,CAACC,MAAM,CAACC,QAApE,CACA,GAAMC,CAAAA,OAAO,CAAG,WAAWL,IAAX,CAAgBC,SAAS,CAACC,SAA1B,CAAhB,CACA,GAAI,CAACH,GAAD,EAAQ,CAACM,OAAb,CAAsB,OAEtB,GAAIC,CAAAA,mBAAmB,8DAAyDT,OAAzD,CAAvB,CAEA;AACA,GAAIE,GAAJ,CAAS,CACPO,mBAAmB,EAAI,WAAaR,SAApC,CACD,CAED,MAAOQ,CAAAA,mBAAP,CACD,CAED,MAAO,SAASC,CAAAA,WAAT,MAAwD,mBAAjCC,CAAAA,OAAiC,MAAjCA,OAAiC,CAC7D,GAAMC,CAAAA,OAAO,CAAG1B,UAAU,EAA1B,CACA,GAAM2B,CAAAA,UAAU,CAAGzB,aAAa,EAAhC,CACA,GAAM0B,CAAAA,eAAe,CAAGzB,YAAY,EAApC,CAH6D,mBAIxCF,aAAa,EAJ2B,kDAIpD4B,QAJoD,oBAK7D,GAAMC,CAAAA,gBAAgB,CAAG,aAAAhC,SAAS,UAAT,wCAAaiC,QAAb,GAAyB,CAAlD,CACA,GAAMC,CAAAA,WAAW,CAAGF,gBAAgB,CAAGrC,gBAAvC,CACA,GAAMqB,CAAAA,OAAO,CAAGW,OAAO,CAACQ,SAAR,CAAkBC,QAAlB,EAAhB,CACA,GAAMC,CAAAA,iBAAiB,CACrBT,OAAO,GAAK,SAAZ,EAAyBA,OAAO,EAAII,gBADtC,CAEA,GAAMP,CAAAA,mBAAmB,CAAGV,kBAAkB,CAACC,OAAD,CAAUkB,WAAV,CAA9C,CAV6D,oBAWjCzC,KAAK,CAAC6C,QAAN,CAAe,KAAf,CAXiC,oDAWtDC,MAXsD,qBAW9CC,SAX8C,0CAYjC/C,KAAK,CAAC6C,QAAN,CAAe,CAACb,mBAAhB,CAZiC,qDAYtDgB,MAZsD,qBAY9CC,SAZ8C,0CAarBjD,KAAK,CAAC6C,QAAN,CAAe,KAAf,CAbqB,qDAatDK,YAbsD,qBAaxCC,eAbwC,0CAc7BnD,KAAK,CAAC6C,QAAN,EAd6B,qDActDO,QAdsD,qBAc5CC,WAd4C,0CAefrD,KAAK,CAAC6C,QAAN,CAAe,EAAf,CAfe,sDAetDS,eAfsD,sBAerCC,kBAfqC,sBAiB7D,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACxB7B,SAAS,CAAC8B,SAAV,CAAoBC,SAApB,CAA8BnC,OAA9B,EACAwB,SAAS,CAAC,IAAD,CAAT,CACD,CAHD,CAKA,GAAMY,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,KAAD,CAA8C,CACnEL,kBAAkB,CAAC,EAAD,CAAlB,CACA,GAAI,CACFF,WAAW,CAAC,GAAIlD,CAAAA,SAAJ,CAAcyD,KAAK,CAACC,aAAN,CAAoBC,KAAlC,CAAD,CAAX,CACD,CAAC,MAAOC,GAAP,CAAY,CACZV,WAAW,CAACW,SAAD,CAAX,CACD,CACF,CAPD,CASA,GAAMC,CAAAA,eAAe,CAAGjE,KAAK,CAACkE,OAAN,CAAc,UAAM,CAC1C,MACE9B,CAAAA,UAAU,EAAIC,eAAd,EAAiCe,QAAjC,EAA6C,MAAOjB,CAAAA,OAAP,GAAmB,QADlE,CAGD,CAJuB,CAIrB,CAACC,UAAD,CAAaC,eAAb,CAA8Be,QAA9B,CAAwCjB,OAAxC,CAJqB,CAAxB,CAMA,GAAMgC,CAAAA,aAAa,CAAGnE,KAAK,CAACoE,WAAN,CAAkB,UAAM,CAC5C,GACEhC,UAAU,EACVC,eADA,EAEAe,QAFA,EAGA,MAAOjB,CAAAA,OAAP,GAAmB,QAJrB,CAKE,CACA,wDAAC,yKAES/B,CAAAA,yBAAyB,CAC7BgC,UAD6B,CAE7B,GAAI9B,CAAAA,WAAJ,CAAgB,CAAE+B,eAAe,CAAfA,eAAF,CAAhB,EAAqCgC,GAArC,CACEhE,aAAa,CAACiE,QAAd,CAAuB,CACrBC,UAAU,CAAErC,OAAO,CAACQ,SADC,CAErBU,QAAQ,CAARA,QAFqB,CAGrBtC,QAAQ,CAAEqB,OAAO,CAAG,IAHC,CAAvB,CADF,CAF6B,CAS7B,CAACD,OAAD,CAT6B,CAU7B,CAAEsC,UAAU,CAAE,cAAd,CAA8BC,mBAAmB,CAAE,cAAnD,CAV6B,CAFlC,QAcGlB,kBAAkB,CAAC,oBAAD,CAAlB,CAdH,+EAgBGmB,OAAO,CAACC,KAAR,cACApB,kBAAkB,CAAC,iBAAD,CAAlB,CAjBH,oEAAD,KAoBD,CACF,CA5BqB,CA4BnB,CAACrB,OAAD,CAAUC,OAAV,CAAmBC,UAAnB,CAA+BC,eAA/B,CAAgDe,QAAhD,CA5BmB,CAAtB,CA8BApD,KAAK,CAAC4E,SAAN,CAAgB,UAAM,CACpB,GAAI,CAAC9B,MAAL,CAAa,OACb,GAAM+B,CAAAA,SAAS,CAAGC,UAAU,CAAC,UAAM,CACjC/B,SAAS,CAAC,KAAD,CAAT,CACD,CAF2B,CAEzB,IAFyB,CAA5B,CAGA,MAAO,kBAAMgC,CAAAA,YAAY,CAACF,SAAD,CAAlB,EAAP,CACD,CAND,CAMG,CAAC/B,MAAD,CANH,EAQA,mBACE,aAAK,SAAS,CAAC,WAAf,wBACE,aAAK,SAAS,CAAC,aAAf,wBACE,WAAI,SAAS,CAAC,oCAAd,oBADF,CAEGX,OAAO,GAAK,SAAZ,eACC,aAAM,SAAS,gBAAUS,iBAAiB,CAAG,SAAH,CAAe,SAA1C,CAAf,UACGA,iBAAiB,CACd,qBADc,CAEdZ,mBAAmB,CACnB,mBADmB,CAEnB,sBALN,EAHJ,GADF,cAcE,aAAK,SAAS,CAAC,WAAf,wBACE,aAAK,SAAS,CAAC,wDAAf,wBACE,YAAK,SAAS,CAAC,kBAAf,qBADF,cAEE,kCACE,cAAM,SAAS,CAAC,sBAAhB,CAAuC,OAAO,CAAEwB,WAAhD,wBACE,aAAM,SAAS,CAAC,sBAAhB,EADF,CAEGV,MAAM,CAAG,QAAH,CAAc,MAFvB,GADF,EAFF,GADF,cAWE,YAAK,SAAS,CAAC,gCAAf,uBACE,aAAM,SAAS,CAAC,kCAAhB,uBACE,WAAI,SAAS,CAAC,oBAAd,UAAoCvB,OAApC,EADF,EADF,EAXF,cAiBE,aAAK,SAAS,CAAC,2EAAf,wBACE,YAAK,SAAS,CAAC,kBAAf,qBADF,cAEE,aACE,SAAS,CAAC,2BADZ,CAEE,OAAO,CAAE,yBAAM0B,CAAAA,SAAS,CAAC,SAAC+B,EAAD,QAAQ,CAACA,EAAT,EAAD,CAAf,EAFX,UAIGhC,MAAM,CAAG,MAAH,CAAY,MAJrB,EAFF,GAjBF,CA2BGA,MAAM,eACL,YAAK,SAAS,CAAC,0EAAf,uBACE,KAAC,MAAD,EACE,KAAK,kBAAYzB,OAAZ,oBAA8BkB,WAA9B,CADP,CAEE,aAAa,KAFf,CAGE,OAAO,CAAC,MAHV,CAIE,OAAO,CAAC,MAJV,CAKE,QAAQ,CAAC,KALX,CAME,SAAS,CAAC,SANZ,EADF,EA5BJ,cAwCE,aAAK,SAAS,CAAC,2EAAf,wBACE,YAAK,SAAS,CAAC,kBAAf,0BADF,cAEE,aAAM,SAAS,CAAC,kBAAhB,uBACE,WAAI,SAAS,CAAC,MAAd,UACGN,OAAO,GAAK,SAAZ,cACC,aAAM,SAAS,CAAC,mCAAhB,EADD,CAGCtB,mBAAmB,CAACsB,OAAD,CAJvB,EADF,EAFF,GAxCF,cAqDE,aAAK,SAAS,CAAC,2EAAf,wBACE,YAAK,SAAS,CAAC,kBAAf,4BADF,cAEE,aACE,SAAS,CAAC,sBADZ,CAEE,OAAO,CAAE,kBAAM,CACbgB,eAAe,CAAC,SAAC8B,IAAD,QAAU,CAACA,IAAX,EAAD,CAAf,CACA1B,kBAAkB,CAAC,EAAD,CAAlB,CACD,CALH,UAOGL,YAAY,CAAG,MAAH,CAAY,UAP3B,EAFF,GArDF,CAkEGA,YAAY,eACX,aAAK,SAAS,CAAC,yBAAf,WACGI,eAAe,eAAI,mBAAIA,eAAJ,EADtB,cAEE,aAAK,SAAS,CAAC,mDAAf,wBACE,cACE,IAAI,CAAC,MADP,CAEE,SAAS,CAAC,cAFZ,CAGE,KAAK,CAAE,CAAE4B,IAAI,CAAE,CAAR,CAAWC,QAAQ,CAAE,OAArB,CAHT,CAIE,WAAW,CAAC,YAJd,CAKE,OAAO,CAAExB,cALX,EADF,cAQE,cACE,SAAS,CAAC,2BADZ,CAEE,IAAI,CAAC,QAFP,CAGE,KAAK,CAAC,UAHR,CAIE,QAAQ,CAAE,CAACM,eAJb,CAKE,OAAO,CAAE,yBAAME,CAAAA,aAAa,EAAnB,EALX,EARF,GAFF,GAnEJ,cAwFE,aAAK,SAAS,CAAC,mDAAf,wBACE,YAAK,SAAS,CAAC,kBAAf,2BADF,cAEE,cACE,SAAS,CAAC,sBADZ,CAEE,OAAO,CAAE,yBAAM7B,CAAAA,QAAQ,CAAC0B,SAAD,CAAd,EAFX,wBAIE,aAAM,SAAS,CAAC,iBAAhB,EAJF,UAFF,GAxFF,CAmGGhC,mBAAmB,eAClB,aAAK,SAAS,CAAC,wEAAf,wBACE,YAAK,SAAS,CAAC,kBAAf,uBADF,cAEE,WACE,SAAS,CAAC,qBADZ,CAEE,IAAI,CAAEA,mBAFR,CAGE,MAAM,CAAC,QAHT,CAIE,GAAG,CAAC,qBAJN,wBAME,aAAM,SAAS,CAAC,0BAAhB,EANF,uBAFF,GApGJ,GAdF,cAgIE,KAAC,MAAD,IAhIF,GADF,CAoID,CAED,QAASoD,CAAAA,MAAT,EAAkB,iBAChB,GAAMjD,CAAAA,OAAO,CAAG1B,UAAU,EAA1B,CACA,GAAM8B,CAAAA,gBAAgB,CAAG,cAAAhC,SAAS,UAAT,0CAAaiC,QAAb,GAAyB,CAAlD,CACA,GAAM6C,CAAAA,eAAe,CAAG7E,kBAAkB,EAA1C,CAEA,GAAM8E,CAAAA,UAAU,CAAGnD,OAAO,EAAII,gBAA9B,CACA,mBACE,aAAK,SAAS,CAAC,mDAAf,wBACE,cACE,IAAI,CAAC,QADP,CAEE,KAAK,CAAC,MAFR,CAGE,QAAQ,CAAE,CAAC+C,UAHb,CAIE,SAAS,CAAC,mCAJZ,CAKE,OAAO,CAAED,eALX,EADF,cAQE,cAAM,SAAS,CAAC,uBAAhB,6BACkBxE,mBAAmB,CAAC0B,gBAAD,CADrC,GARF,GADF,CAcD","sourcesContent":["import React from \"react\";\nimport QRCode from \"qrcode.react\";\nimport {\n  Account,\n  LAMPORTS_PER_SOL,\n  PublicKey,\n  sendAndConfirmTransaction,\n  SystemProgram,\n  Transaction,\n} from \"@solana/web3.js\";\n\nimport { useConfig, useRefreshAccounts } from \"providers/server/http\";\nimport { useBalance } from \"providers/rpc/balance\";\nimport { usePayerState } from \"providers/wallet\";\nimport { useConnection } from \"providers/rpc\";\nimport { useBlockhash } from \"providers/rpc/blockhash\";\n\nexport function lamportsToSolString(\n  lamports: number,\n  maximumFractionDigits: number = 9\n): string {\n  const sol = Math.abs(lamports) / LAMPORTS_PER_SOL;\n  return (\n    \"◎\" + new Intl.NumberFormat(\"en-US\", { maximumFractionDigits }).format(sol)\n  );\n}\n\nexport function getTrustWalletLink(\n  address: string,\n  amountSol: number\n): string | undefined {\n  const iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n  const android = /Android/i.test(navigator.userAgent);\n  if (!iOS && !android) return;\n\n  let trustWalletDeepLink = `https://link.trustwallet.com/send?coin=501&address=${address}`;\n\n  // Only the iOS TW handles amount correctly at the moment\n  if (iOS) {\n    trustWalletDeepLink += \"&amount=\" + amountSol;\n  }\n\n  return trustWalletDeepLink;\n}\n\nexport function PaymentCard({ account }: { account: Account }) {\n  const balance = useBalance();\n  const connection = useConnection();\n  const recentBlockhash = useBlockhash();\n  const [, setPayer] = usePayerState();\n  const gameCostLamports = useConfig()?.gameCost || 0;\n  const gameCostSol = gameCostLamports / LAMPORTS_PER_SOL;\n  const address = account.publicKey.toBase58();\n  const balanceSufficient =\n    balance !== \"loading\" && balance >= gameCostLamports;\n  const trustWalletDeepLink = getTrustWalletLink(address, gameCostSol);\n  const [copied, setCopied] = React.useState(false);\n  const [showQR, setShowQR] = React.useState(!trustWalletDeepLink);\n  const [showWithdraw, setShowWithdraw] = React.useState(false);\n  const [toPubkey, setToPubkey] = React.useState<PublicKey>();\n  const [withdrawMessage, setWithdrawMessage] = React.useState(\"\");\n\n  const copyAddress = () => {\n    navigator.clipboard.writeText(address);\n    setCopied(true);\n  };\n\n  const updateToPubkey = (event: React.FormEvent<HTMLInputElement>) => {\n    setWithdrawMessage(\"\");\n    try {\n      setToPubkey(new PublicKey(event.currentTarget.value));\n    } catch (err) {\n      setToPubkey(undefined);\n    }\n  };\n\n  const withdrawEnabled = React.useMemo(() => {\n    return (\n      connection && recentBlockhash && toPubkey && typeof balance === \"number\"\n    );\n  }, [connection, recentBlockhash, toPubkey, balance]);\n\n  const withdrawFunds = React.useCallback(() => {\n    if (\n      connection &&\n      recentBlockhash &&\n      toPubkey &&\n      typeof balance === \"number\"\n    ) {\n      (async () => {\n        try {\n          await sendAndConfirmTransaction(\n            connection,\n            new Transaction({ recentBlockhash }).add(\n              SystemProgram.transfer({\n                fromPubkey: account.publicKey,\n                toPubkey,\n                lamports: balance - 5000,\n              })\n            ),\n            [account],\n            { commitment: \"singleGossip\", preflightCommitment: \"singleGossip\" }\n          );\n          setWithdrawMessage(\"Withdraw succeeded\");\n        } catch (err) {\n          console.error(err);\n          setWithdrawMessage(\"Withdraw failed\");\n        }\n      })();\n    }\n  }, [account, balance, connection, recentBlockhash, toPubkey]);\n\n  React.useEffect(() => {\n    if (!copied) return;\n    const timeoutId = setTimeout(() => {\n      setCopied(false);\n    }, 1000);\n    return () => clearTimeout(timeoutId);\n  }, [copied]);\n\n  return (\n    <div className=\"card mb-0\">\n      <div className=\"card-header\">\n        <h3 className=\"card-header-title font-weight-bold\">Wallet</h3>\n        {balance !== \"loading\" && (\n          <span className={`text-${balanceSufficient ? \"primary\" : \"warning\"}`}>\n            {balanceSufficient\n              ? \"Press Play to Start\"\n              : trustWalletDeepLink\n              ? \"Add Funds to Play\"\n              : \"Transfer SOL to Play\"}\n          </span>\n        )}\n      </div>\n\n      <div className=\"card-body\">\n        <div className=\"d-flex align-items-center justify-content-between mb-4\">\n          <div className=\"font-weight-bold\">Address</div>\n          <div>\n            <span className=\"btn btn-sm btn-white\" onClick={copyAddress}>\n              <span className=\"fe fe-clipboard mr-2\"></span>\n              {copied ? \"Copied\" : \"Copy\"}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"d-flex mb-4 pb-4 border-bottom\">\n          <span className=\"badge badge-dark overflow-hidden\">\n            <h4 className=\"mb-0 text-truncate\">{address}</h4>\n          </span>\n        </div>\n\n        <div className=\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\">\n          <div className=\"font-weight-bold\">QR Code</div>\n          <span\n            className=\"btn btn-sm btn-white ml-2\"\n            onClick={() => setShowQR((qr) => !qr)}\n          >\n            {showQR ? \"Hide\" : \"Show\"}\n          </span>\n        </div>\n\n        {showQR && (\n          <div className=\"d-flex justify-content-center align-items-center mb-4 pb-4 border-bottom\">\n            <QRCode\n              value={`solana:${address}?amount=${gameCostSol}`}\n              includeMargin\n              bgColor=\"#000\"\n              fgColor=\"#FFF\"\n              renderAs=\"svg\"\n              className=\"qr-code\"\n            />\n          </div>\n        )}\n\n        <div className=\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\">\n          <div className=\"font-weight-bold\">Live Balance</div>\n          <span className=\"badge badge-dark\">\n            <h4 className=\"mb-0\">\n              {balance === \"loading\" ? (\n                <span className=\"spinner-grow spinner-grow-sm mr-2\"></span>\n              ) : (\n                lamportsToSolString(balance)\n              )}\n            </h4>\n          </span>\n        </div>\n\n        <div className=\"d-flex align-items-center justify-content-between mb-4 pb-4 border-bottom\">\n          <div className=\"font-weight-bold\">Withdraw Funds</div>\n          <span\n            className=\"btn btn-sm btn-white\"\n            onClick={() => {\n              setShowWithdraw((show) => !show);\n              setWithdrawMessage(\"\");\n            }}\n          >\n            {showWithdraw ? \"Hide\" : \"Withdraw\"}\n          </span>\n        </div>\n\n        {showWithdraw && (\n          <div className=\"mb-4 pb-4 border-bottom\">\n            {withdrawMessage && <p>{withdrawMessage}</p>}\n            <div className=\"d-flex align-items-center justify-content-between\">\n              <input\n                type=\"text\"\n                className=\"form-control\"\n                style={{ flex: 1, maxWidth: \"500px\" }}\n                placeholder=\"To Address\"\n                onInput={updateToPubkey}\n              />\n              <input\n                className=\"btn btn-sm btn-white ml-2\"\n                type=\"button\"\n                value=\"Withdraw\"\n                disabled={!withdrawEnabled}\n                onClick={() => withdrawFunds()}\n              />\n            </div>\n          </div>\n        )}\n\n        <div className=\"d-flex align-items-center justify-content-between\">\n          <div className=\"font-weight-bold\">Change Wallet</div>\n          <span\n            className=\"btn btn-sm btn-white\"\n            onClick={() => setPayer(undefined)}\n          >\n            <span className=\"fe fe-list mr-2\"></span>\n            List\n          </span>\n        </div>\n\n        {trustWalletDeepLink && (\n          <div className=\"d-flex align-items-center justify-content-between mt-4 pt-4 border-top\">\n            <div className=\"font-weight-bold\">Add Funds</div>\n            <a\n              className=\"btn btn-sm btn-info\"\n              href={trustWalletDeepLink}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <span className=\"fe fe-external-link mr-2\"></span>\n              Open Trust Wallet\n            </a>\n          </div>\n        )}\n      </div>\n      <Footer />\n    </div>\n  );\n}\n\nfunction Footer() {\n  const balance = useBalance();\n  const gameCostLamports = useConfig()?.gameCost || 0;\n  const refreshAccounts = useRefreshAccounts();\n\n  const sufficient = balance >= gameCostLamports;\n  return (\n    <div className=\"card-footer d-flex flex-column align-items-center\">\n      <input\n        type=\"button\"\n        value=\"Play\"\n        disabled={!sufficient}\n        className=\"btn btn-pink w-100 text-uppercase\"\n        onClick={refreshAccounts}\n      />\n      <span className=\"text-muted small mt-2\">\n        One play costs {lamportsToSolString(gameCostLamports)}\n      </span>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}