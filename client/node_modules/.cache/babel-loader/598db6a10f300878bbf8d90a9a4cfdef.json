{"ast":null,"code":"var _jsxFileName = \"/Users/jstarry/Workspace/solana/break/client/src/providers/worker.tsx\";\nimport * as React from \"react\";\nimport { WorkerLink } from \"worker/link\";\nimport { useConfig, useAccounts } from \"./api\";\nimport { useBlockhash } from \"./blockhash\";\nconst StateContext = React.createContext(undefined);\nconst ActiveUsersContext = React.createContext(undefined);\nexport const WORKER = new WorkerLink();\nexport function WorkerProvider({\n  children\n}) {\n  const [state, setState] = React.useState(\"loading\");\n  const [activeUsers, setActiveUsers] = React.useState(1);\n  const blockhash = useBlockhash();\n  React.useEffect(() => {\n    if (blockhash) WORKER.send({\n      type: \"blockhash\",\n      blockhash\n    });\n  }, [blockhash]);\n  const accounts = useAccounts();\n  React.useEffect(() => {\n    if (accounts) WORKER.send({\n      type: \"accounts\",\n      feeAccounts: accounts.feeAccounts.map(a => a.secretKey),\n      programAccounts: accounts.programAccounts.map(a => a.toBase58())\n    });\n  }, [accounts]);\n  const config = useConfig();\n  const programId = config === null || config === void 0 ? void 0 : config.programId;\n  const clusterUrl = config === null || config === void 0 ? void 0 : config.clusterUrl;\n  React.useEffect(() => {\n    if (programId && clusterUrl) {\n      WORKER.send({\n        type: \"init\",\n        programId: programId.toBase58(),\n        clusterUrl\n      });\n    }\n  }, [programId, clusterUrl]);\n  React.useEffect(() => {\n    WORKER.setReadyListener(() => {\n      setState(\"ready\");\n    });\n    WORKER.setUsersListener(count => {\n      setActiveUsers(count);\n    });\n  }, []);\n  return /*#__PURE__*/React.createElement(StateContext.Provider, {\n    value: state,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(ActiveUsersContext.Provider, {\n    value: activeUsers,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 7\n    }\n  }, children));\n}\nexport function useWorkerState() {\n  const state = React.useContext(StateContext);\n\n  if (!state) {\n    throw new Error(`useWorkerState must be used within a WorkerProvider`);\n  }\n\n  return state;\n}\nexport function useActiveUsers() {\n  const context = React.useContext(ActiveUsersContext);\n\n  if (!context) {\n    throw new Error(`useActiveUsers must be used within a WorkerProvider`);\n  }\n\n  return context;\n}","map":{"version":3,"sources":["/Users/jstarry/Workspace/solana/break/client/src/providers/worker.tsx"],"names":["React","WorkerLink","useConfig","useAccounts","useBlockhash","StateContext","createContext","undefined","ActiveUsersContext","WORKER","WorkerProvider","children","state","setState","useState","activeUsers","setActiveUsers","blockhash","useEffect","send","type","accounts","feeAccounts","map","a","secretKey","programAccounts","toBase58","config","programId","clusterUrl","setReadyListener","setUsersListener","count","useWorkerState","useContext","Error","useActiveUsers","context"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { WorkerLink } from \"worker/link\";\nimport { useConfig, useAccounts } from \"./api\";\nimport { useBlockhash } from \"./blockhash\";\n\ntype State = \"loading\" | \"ready\";\nconst StateContext = React.createContext<State | undefined>(undefined);\nconst ActiveUsersContext = React.createContext<number | undefined>(undefined);\n\nexport const WORKER = new WorkerLink();\n\ntype ProviderProps = { children: React.ReactNode };\nexport function WorkerProvider({ children }: ProviderProps) {\n  const [state, setState] = React.useState<State>(\"loading\");\n  const [activeUsers, setActiveUsers] = React.useState<number>(1);\n\n  const blockhash = useBlockhash();\n  React.useEffect(() => {\n      if (blockhash) WORKER.send({type: \"blockhash\", blockhash});\n  }, [blockhash]);\n\n  const accounts = useAccounts();\n  React.useEffect(() => {\n      if (accounts) WORKER.send({type: \"accounts\",\n      feeAccounts: accounts.feeAccounts.map(a => a.secretKey),\n      programAccounts: accounts.programAccounts.map(a => a.toBase58())\n    });\n  }, [accounts]);\n\n  const config = useConfig();\n  const programId = config?.programId;\n  const clusterUrl = config?.clusterUrl;\n  React.useEffect(() => {\n      if (programId && clusterUrl) {\n        WORKER.send({ type: \"init\", programId: programId.toBase58(), clusterUrl });\n      }\n  }, [programId, clusterUrl]);\n\n  React.useEffect(() => {\n      WORKER.setReadyListener(() => {\n        setState(\"ready\");\n      })\n      WORKER.setUsersListener((count) => {\n        setActiveUsers(count);\n      })\n  }, []);\n\n  return (\n    <StateContext.Provider value={state}>\n      <ActiveUsersContext.Provider value={activeUsers}>\n        {children}\n      </ActiveUsersContext.Provider>\n    </StateContext.Provider>\n  );\n}\n\nexport function useWorkerState() {\n  const state = React.useContext(StateContext);\n  if (!state) {\n    throw new Error(`useWorkerState must be used within a WorkerProvider`);\n  }\n\n  return state;\n}\n\nexport function useActiveUsers() {\n  const context = React.useContext(ActiveUsersContext);\n  if (!context) {\n    throw new Error(`useActiveUsers must be used within a WorkerProvider`);\n  }\n\n  return context;\n}\n"]},"metadata":{},"sourceType":"module"}